<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Sebastian Sauer Blog</title>
<meta name="description" content="Describe this nonsense.">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://sebastiansauer.github.io/images/farb3.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="Describe this nonsense.">
<meta name="twitter:creator" content="@sauer_sebastian">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="https://sebastiansauer.github.io/page4/">
<meta property="og:site_name" content="Sebastian Sauer Blog">





<link rel="canonical" href="https://sebastiansauer.github.io/page4/">
<link href="https://sebastiansauer.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Sebastian Sauer Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://sebastiansauer.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://sebastiansauer.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://sebastiansauer.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://sebastiansauer.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://sebastiansauer.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://sebastiansauer.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://sebastiansauer.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://sebastiansauer.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://sebastiansauer.github.io/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://sebastiansauer.github.io/images/ses_201102_xsmall.jpg" alt="Sebastian Sauer photo" class="author-photo">
					<h4>Sebastian Sauer</h4>
					<p>Professor at FOM University of Applied Sciences. Thinker on own peril.</p>
				</li>
				<li><a href="https://sebastiansauer.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:ssauer@posteo.de"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/sauer_sebastian"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="https://linkedin.com/in/https://www.linkedin.com/in/dr-sebastian-sauer-4791762"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/sebastiansauer"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="http://stackoverflow.com/users/4434263/sebastian-sauer"><i class="fa fa-fw fa-stack-exchange"></i> Stackexchange</a>
				</li>
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://sebastiansauer.github.io/posts/">All Posts</a></li>
				<li><a href="https://sebastiansauer.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="">Laurenz Sauer</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="https://sebastiansauer.github.io/images/farb3.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Sebastian Sauer Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-09-28T00:00:00-04:00"><a href="https://sebastiansauer.github.io/summary-mult-cols-purrr/">September 28, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~5 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/summary-mult-cols-purrr/" rel="bookmark" title="Summary for multiple variables using purrr" itemprop="url">Summary for multiple variables using purrr</a></h1>
    
  </header>
  <div class="entry-content">
    <p>A frequent task in data analysis is to get a summary of a bunch of variables. Often, graphical summaries (diagrams) are wanted. However, at times numerical summaries are in order. How to get that in R? That’s the question of the present post.</p>

<p>Of course, there are several ways. One way, using <code class="highlighter-rouge">purrr</code>, is the following. I liked it quite a bit that’s why I am showing it here.</p>

<p>First, let’s load some data and some packages we will make use of.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="p">(</span><span class="n">Affairs</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"AER"</span><span class="p">)</span><span class="w">

</span><span class="n">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Define two helper functions we will need later on:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">add_na_col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">){</span><span class="w">
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">na</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">has_n_col</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">){</span><span class="w">
  </span><span class="nf">return</span><span class="p">(</span><span class="n">ncol</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">n</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Set one value to <code class="highlighter-rouge">NA</code> for illustration purposes:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Affairs</span><span class="o">$</span><span class="n">affairs</span><span class="p">[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">  </span><span class="c1"># one NA for illustrative purposes
</span></code></pre>
</div>

<p>Now comes the show:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Affairs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">select_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">tidy</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">.x</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># compute tidy summary of each var
</span><span class="w">  </span><span class="n">map_if</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">has_n_col</span><span class="p">,</span><span class="w"> </span><span class="n">add_na_col</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">   </span><span class="c1"># add na-col if missing
</span><span class="w">  </span><span class="n">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Affairs_summary</span><span class="w">  </span><span class="c1"># bind list elements into df
</span><span class="w">
</span><span class="n">Affairs_summary</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##               minimum q1 median   mean    q3 maximum na
## affairs         0.000  0      0  1.458  0.25      12  1
## age            17.500 27     32 32.490 37.00      57  0
## yearsmarried    0.125  4      7  8.178 15.00      15  0
## religiousness   1.000  2      3  3.116  4.00       5  0
## education       9.000 14     16 16.170 18.00      20  0
## occupation      1.000  3      5  4.195  6.00       7  0
## rating          1.000  3      4  3.932  5.00       5  0
</code></pre>
</div>

<p>What we did was:</p>

<ol>
  <li>Get the <code class="highlighter-rouge">Affairs</code> data, and select the numeric columns</li>
  <li>Map the <code class="highlighter-rouge">summary</code> function to each column, and tidy up each column. We will get a list of tidy summaries.</li>
  <li>If a list element has 6 elements (or columns, because we want to end up with a data frame), then we know there is no <code class="highlighter-rouge">NA</code>-column. In this case, <code class="highlighter-rouge">add_na_col</code>, else not. That’s what the <code class="highlighter-rouge">map_if</code> bit does.</li>
  <li>Lastly, bind the list elements row wise. To that end, give a bag of summary-elements to <code class="highlighter-rouge">rbind</code> by help of <code class="highlighter-rouge">do.call</code>.</li>
</ol>

<p>Instead of <code class="highlighter-rouge">purr::map</code>, a more familiar approach would have been this:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Affairs</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">lapply</span><span class="p">(</span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">tidy</span><span class="p">(</span><span class="n">summary</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w">  </span><span class="c1"># compute tidy summary of each var
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## $affairs
##   minimum q1 median  mean   q3 maximum na
## 1       0  0      0 1.458 0.25      12  1
## 
## $age
##   minimum q1 median  mean q3 maximum
## 1    17.5 27     32 32.49 37      57
## 
## $yearsmarried
##   minimum q1 median  mean q3 maximum
## 1   0.125  4      7 8.178 15      15
## 
## $religiousness
##   minimum q1 median  mean q3 maximum
## 1       1  2      3 3.116  4       5
## 
## $education
##   minimum q1 median  mean q3 maximum
## 1       9 14     16 16.17 18      20
## 
## $occupation
##   minimum q1 median  mean q3 maximum
## 1       1  3      5 4.195  6       7
## 
## $rating
##   minimum q1 median  mean q3 maximum
## 1       1  3      4 3.932  5       5
</code></pre>
</div>

<p>And, finally, a quite nice formatting tool for html tables is <code class="highlighter-rouge">DT:datatable</code> (output not shown):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">DT</span><span class="p">)</span><span class="w">
</span><span class="n">datatable</span><span class="p">(</span><span class="n">Affairs_summary</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Although this approach may not work in each environment, particularly not with <code class="highlighter-rouge">knitr</code> (as far as I know of).</p>

<p>That’s why an alternative html table approach is used:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">htmlTable</span><span class="p">)</span><span class="w">

</span><span class="n">htmlTable</span><span class="p">(</span><span class="n">Affairs_summary</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">minimum</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">q1</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">median</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">mean</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">q3</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">maximum</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">na</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">affairs</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1.458</td>
<td style="text-align: center;">0.25</td>
<td style="text-align: center;">12</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: left;">age</td>
<td style="text-align: center;">17.5</td>
<td style="text-align: center;">27</td>
<td style="text-align: center;">32</td>
<td style="text-align: center;">32.49</td>
<td style="text-align: center;">37</td>
<td style="text-align: center;">57</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: left;">yearsmarried</td>
<td style="text-align: center;">0.125</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">8.178</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">15</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: left;">religiousness</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">3.116</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: left;">education</td>
<td style="text-align: center;">9</td>
<td style="text-align: center;">14</td>
<td style="text-align: center;">16</td>
<td style="text-align: center;">16.17</td>
<td style="text-align: center;">18</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="text-align: left;">occupation</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">4.195</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">0</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">rating</td>
<td style="border-bottom: 2px solid grey; text-align: center;">1</td>
<td style="border-bottom: 2px solid grey; text-align: center;">3</td>
<td style="border-bottom: 2px solid grey; text-align: center;">4</td>
<td style="border-bottom: 2px solid grey; text-align: center;">3.932</td>
<td style="border-bottom: 2px solid grey; text-align: center;">5</td>
<td style="border-bottom: 2px solid grey; text-align: center;">5</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
</tr>
</tbody>
</table>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-09-26T00:00:00-04:00"><a href="https://sebastiansauer.github.io/EDIT-multiple_lm_purrr_EDIT/">September 26, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~9 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/EDIT-multiple_lm_purrr_EDIT/" rel="bookmark" title="EDIT: Running multiple simple regressions with purrr" itemprop="url">EDIT: Running multiple simple regressions with purrr</a></h1>
    
  </header>
  <div class="entry-content">
    <p>EDIT based on comments/ suggeestions from @JonoCarroll <a href="https://disqus.com/by/JonoCarroll/?utm_source=reply&amp;utm_medium=email&amp;utm_content=comment_author">Disqus profile</a> and @tjmahr <a href="https://twitter.com/tjmahr">twitter profile</a>. See below (last step; look for “EDIT”).</p>

<p>Thanks for the input! :thumbsup:</p>

<p><em>reading time: 10 min.</em></p>

<p>Hadley Wickham’s <code class="highlighter-rouge">purrr</code> has given a new look at handling data structures to the typical R user (some reasoning suggests that average users doesn’t exist, but that’s a different story).</p>

<p>I just tried the following with purrr:
- Meditate about the running a simple regression, FWIW
- Take a dataframe with candidate predictors and an outcome
- Throw one predictor at a time into the regression, where the outcome variable remains the same (i.,e multiple simple regressions (one predictor) where the predictor is changed at each run but the outcome remains the same)
- tidy up the resulting $R^2$ in some nice format</p>

<p>I found that <code class="highlighter-rouge">purrr</code> does the job nicely, and it’s quite instructive to see <code class="highlighter-rouge">purrr</code>at work, I think. That’s why I wrote it up in this short post:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span><span class="w">  
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">  </span><span class="c1"># for kable
</span><span class="n">data</span><span class="p">(</span><span class="n">Fair</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ecdat"</span><span class="p">)</span><span class="w"> </span><span class="c1"># extramarital affairs dataset
</span><span class="n">glimpse</span><span class="p">(</span><span class="n">Fair</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Observations: 601
## Variables: 9
## $ sex        &lt;fctr&gt; male, female, female, male, male, female, female, ...
## $ age        &lt;dbl&gt; 37, 27, 32, 57, 22, 32, 22, 57, 32, 22, 37, 27, 47,...
## $ ym         &lt;dbl&gt; 10.00, 4.00, 15.00, 15.00, 0.75, 1.50, 0.75, 15.00,...
## $ child      &lt;fctr&gt; no, no, yes, yes, no, no, no, yes, yes, no, yes, y...
## $ religious  &lt;int&gt; 3, 4, 1, 5, 2, 2, 2, 2, 4, 4, 2, 4, 5, 2, 4, 1, 2, ...
## $ education  &lt;dbl&gt; 18, 14, 12, 18, 17, 17, 12, 14, 16, 14, 20, 18, 17,...
## $ occupation &lt;int&gt; 7, 6, 1, 6, 6, 5, 1, 4, 1, 4, 7, 6, 6, 5, 5, 5, 4, ...
## $ rate       &lt;int&gt; 4, 4, 4, 5, 3, 5, 3, 4, 2, 5, 2, 4, 4, 4, 4, 5, 3, ...
## $ nbaffairs  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">nbaffairs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># exclude outcome, leave only predictors 
</span><span class="w">  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">lm</span><span class="p">(</span><span class="n">Fair</span><span class="o">$</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_dbl</span><span class="p">(</span><span class="s2">"r.squared"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">rename</span><span class="p">(</span><span class="n">r.squared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">r</span><span class="m">2</span><span class="n">s</span><span class="w">

</span><span class="n">kable</span><span class="p">(</span><span class="n">r</span><span class="m">2</span><span class="n">s</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">names</th>
      <th style="text-align: right">r.squared</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">rate</td>
      <td style="text-align: right">0.0781272</td>
    </tr>
    <tr>
      <td style="text-align: left">ym</td>
      <td style="text-align: right">0.0349098</td>
    </tr>
    <tr>
      <td style="text-align: left">religious</td>
      <td style="text-align: right">0.0208806</td>
    </tr>
    <tr>
      <td style="text-align: left">child</td>
      <td style="text-align: right">0.0108181</td>
    </tr>
    <tr>
      <td style="text-align: left">age</td>
      <td style="text-align: right">0.0090701</td>
    </tr>
    <tr>
      <td style="text-align: left">occupation</td>
      <td style="text-align: right">0.0024613</td>
    </tr>
    <tr>
      <td style="text-align: left">sex</td>
      <td style="text-align: right">0.0001377</td>
    </tr>
    <tr>
      <td style="text-align: left">education</td>
      <td style="text-align: right">0.0000059</td>
    </tr>
  </tbody>
</table>

<p>Ok, that appears to be the list of the $R^2$ for each simple (one-predictor) regression we have run.</p>

<p>Let’s do a quick sense check with the standard way:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">lm1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">lm1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
## Call:
## lm(formula = nbaffairs ~ rate, data = Fair)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.9063 -1.3989 -0.5631 -0.5631 11.4369 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   4.7421     0.4790   9.900   &lt;2e-16 ***
## rate         -0.8358     0.1173  -7.125    3e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.17 on 599 degrees of freedom
## Multiple R-squared:  0.07813,	Adjusted R-squared:  0.07659 
## F-statistic: 50.76 on 1 and 599 DF,  p-value: 3.002e-12
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">lm1</span><span class="p">)</span><span class="o">$</span><span class="n">r.squared</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.07812718
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">lm1</span><span class="p">)</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">]</span><span class="w">  </span><span class="c1">#p.value
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 3.002385e-12
</code></pre>
</div>

<p>Seems to work. To get details of the object <code class="highlighter-rouge">summary(lm1)</code>, use <code class="highlighter-rouge">str(summary(lm1))</code>.</p>

<p>How many did we run? Just the number of columns minus one (the outcome variable).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ncol</span><span class="p">(</span><span class="n">Fair</span><span class="p">)</span><span class="m">-1</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 8
</code></pre>
</div>

<p>FWIW, let’s plot the resulting values (and sort the predictors by descending values).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">r</span><span class="m">2</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">r.squared</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r.squared</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="n">R</span><span class="o">^</span><span class="p">{</span><span class="m">2</span><span class="p">}))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"predictors"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Explained variance per predictor from simple regressions"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-09-23//unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /></p>

<p>Wait, one more thing. Suppose we are not only interested in <script type="math/tex">R^2</script>, but in the p-values (OMG). How to get <em>both</em> values from <code class="highlighter-rouge">purrr</code>?.</p>

<hr />
<p><strong>EDIT</strong> 
(the following part has changed)</p>

<hr />

<p>Thanks for comments from @JonoCarroll <a href="https://disqus.com/by/JonoCarroll/?utm_source=reply&amp;utm_medium=email&amp;utm_content=comment_author">Disqus profile</a> and @tjmahr <a href="https://twitter.com/tjmahr">twitter profile</a>, the last step - extracting the p-values - is now changed, and I think improved.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">nbaffairs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># exclude outcome, leave only predictors 
</span><span class="w">  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">lm</span><span class="p">(</span><span class="n">Fair</span><span class="o">$</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">broom</span><span class="o">::</span><span class="n">tidy</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_df</span><span class="p">(</span><span class="s2">"p.value"</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="nf">round</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"intercept"</span><span class="p">,</span><span class="w"> </span><span class="s2">"predictor"</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ps</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">htmlTable</span><span class="p">)</span><span class="w">

</span><span class="n">htmlTable</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">sex</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">age</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">ym</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">child</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">religious</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">education</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">occupation</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">rate</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">variable</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.465</td>
<td style="text-align: center;">0.019</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0.1</td>
<td style="text-align: center;">0.002</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">intercept</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">2</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0.774</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0.02</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0.011</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0.952</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0.225</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;">predictor</td>
</tr>
</tbody>
</table>

<p>So what I did above basically is:</p>

<ul>
  <li>Run a linear model on each predictor</li>
  <li>Get a <code class="highlighter-rouge">summary</code> of each model</li>
  <li>Tidy (with <code class="highlighter-rouge">broom</code>) each summary</li>
  <li>Get the sublist (column) <code class="highlighter-rouge">p.value</code> from each list (model), and save the result as a data frame</li>
</ul>

<p>To get a whole bunch of relevant statistics, you can use <code class="highlighter-rouge">glance</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">nbaffairs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># exclude outcome, leave only predictors 
</span><span class="w">  </span><span class="n">map</span><span class="p">(</span><span class="w"> </span><span class="o">~</span><span class="n">lm</span><span class="p">(</span><span class="n">Fair</span><span class="o">$</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_df</span><span class="p">(</span><span class="n">glance</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="nf">round</span><span class="p">(</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   r.squared adj.r.squared sigma statistic p.value df
## 1     0.000        -0.002 3.301     0.083   0.774  2
## 2     0.009         0.007 3.287     5.483   0.020  2
## 3     0.035         0.033 3.243    21.667   0.000  2
## 4     0.011         0.009 3.284     6.551   0.011  2
## 5     0.021         0.019 3.267    12.774   0.000  2
## 6     0.000        -0.002 3.302     0.004   0.952  2
## 7     0.002         0.001 3.297     1.478   0.225  2
## 8     0.078         0.077 3.170    50.764   0.000  2
</code></pre>
</div>

<p>Thanks for comments from @JonoCarroll <a href="https://disqus.com/by/JonoCarroll/?utm_source=reply&amp;utm_medium=email&amp;utm_content=comment_author">Disqus profile</a> and @tjmahr <a href="https://twitter.com/tjmahr">twitter profile</a>, the last step - extracting the p-values - is now changed, and I think improved.</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-09-23T00:00:00-04:00"><a href="https://sebastiansauer.github.io/multiple-lm-purrr2/">September 23, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~6 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/multiple-lm-purrr2/" rel="bookmark" title="Running multiple simple regressions with purrr" itemprop="url">Running multiple simple regressions with purrr</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Hadley Wickham’s <code class="highlighter-rouge">purrr</code> has given a new look at handling data structures to the typical R user (some reasoning suggests that average users don’t exist, but that’s a different story).</p>

<p>I just tried the following with purrr:</p>

<ul>
  <li>Meditate about the running a simple regression, FWIW</li>
  <li>Take a dataframe with candidate predictors and an outcome</li>
  <li>Throw one predictor at a time into the regression, where the outcome variable remains the same (i.,e multiple simple regressions (one predictor) where the predictor is changed at each run but the outcome remains the same)</li>
  <li>tidy up the resulting <script type="math/tex">R^2</script> in some nice format.</li>
</ul>

<p>I found that <code class="highlighter-rouge">purrr</code> does the job nicely, and it’s quite instructive, I think. That’s why I wrote it up in this short post:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">purrr</span><span class="p">)</span><span class="w">  
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">knitr</span><span class="p">)</span><span class="w">  </span><span class="c1"># for kable
</span><span class="n">data</span><span class="p">(</span><span class="n">Fair</span><span class="p">,</span><span class="w"> </span><span class="n">package</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Ecdat"</span><span class="p">)</span><span class="w"> </span><span class="c1"># extramarital affairs dataset
</span><span class="n">glimpse</span><span class="p">(</span><span class="n">Fair</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Observations: 601
## Variables: 9
## $ sex        &lt;fctr&gt; male, female, female, male, male, female, female, ...
## $ age        &lt;dbl&gt; 37, 27, 32, 57, 22, 32, 22, 57, 32, 22, 37, 27, 47,...
## $ ym         &lt;dbl&gt; 10.00, 4.00, 15.00, 15.00, 0.75, 1.50, 0.75, 15.00,...
## $ child      &lt;fctr&gt; no, no, yes, yes, no, no, no, yes, yes, no, yes, y...
## $ religious  &lt;int&gt; 3, 4, 1, 5, 2, 2, 2, 2, 4, 4, 2, 4, 5, 2, 4, 1, 2, ...
## $ education  &lt;dbl&gt; 18, 14, 12, 18, 17, 17, 12, 14, 16, 14, 20, 18, 17,...
## $ occupation &lt;int&gt; 7, 6, 1, 6, 6, 5, 1, 4, 1, 4, 7, 6, 6, 5, 5, 5, 4, ...
## $ rate       &lt;int&gt; 4, 4, 4, 5, 3, 5, 3, 4, 2, 5, 2, 4, 4, 4, 4, 5, 3, ...
## $ nbaffairs  &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ...
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">nbaffairs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># exclude outcome, leave only predictors 
</span><span class="w">  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">lm</span><span class="p">(</span><span class="n">Fair</span><span class="o">$</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_dbl</span><span class="p">(</span><span class="s2">"r.squared"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">rename</span><span class="p">(</span><span class="n">r.squared</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">r</span><span class="m">2</span><span class="n">s</span><span class="w">

</span><span class="n">kable</span><span class="p">(</span><span class="n">r</span><span class="m">2</span><span class="n">s</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">names</th>
      <th style="text-align: right">r.squared</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">rate</td>
      <td style="text-align: right">0.0781272</td>
    </tr>
    <tr>
      <td style="text-align: left">ym</td>
      <td style="text-align: right">0.0349098</td>
    </tr>
    <tr>
      <td style="text-align: left">religious</td>
      <td style="text-align: right">0.0208806</td>
    </tr>
    <tr>
      <td style="text-align: left">child</td>
      <td style="text-align: right">0.0108181</td>
    </tr>
    <tr>
      <td style="text-align: left">age</td>
      <td style="text-align: right">0.0090701</td>
    </tr>
    <tr>
      <td style="text-align: left">occupation</td>
      <td style="text-align: right">0.0024613</td>
    </tr>
    <tr>
      <td style="text-align: left">sex</td>
      <td style="text-align: right">0.0001377</td>
    </tr>
    <tr>
      <td style="text-align: left">education</td>
      <td style="text-align: right">0.0000059</td>
    </tr>
  </tbody>
</table>

<p>Ok, that appears to be the list of the <script type="math/tex">R^{2}</script> for each simple (one-predictor) regression we have run.</p>

<p>Let’s do a quick sense check with the standard way:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">lm1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lm</span><span class="p">(</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">rate</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">)</span><span class="w">

</span><span class="n">summary</span><span class="p">(</span><span class="n">lm1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
## Call:
## lm(formula = nbaffairs ~ rate, data = Fair)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -3.9063 -1.3989 -0.5631 -0.5631 11.4369 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)   4.7421     0.4790   9.900   &lt;2e-16 ***
## rate         -0.8358     0.1173  -7.125    3e-12 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.17 on 599 degrees of freedom
## Multiple R-squared:  0.07813,	Adjusted R-squared:  0.07659 
## F-statistic: 50.76 on 1 and 599 DF,  p-value: 3.002e-12
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">lm1</span><span class="p">)</span><span class="o">$</span><span class="n">r.squared</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 0.07812718
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">lm1</span><span class="p">)</span><span class="o">$</span><span class="n">coefficients</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">4</span><span class="p">]</span><span class="w">  </span><span class="c1">#p.value
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 3.002385e-12
</code></pre>
</div>

<p>Seems to work. To get details of the object <code class="highlighter-rouge">summary(lm1)</code>, use <code class="highlighter-rouge">str(summary(lm1))</code>.</p>

<p>How many did we run? Just the number of columns minus one (the outcome variable).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ncol</span><span class="p">(</span><span class="n">Fair</span><span class="p">)</span><span class="m">-1</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 8
</code></pre>
</div>

<p>FWIW, let’s plot the resulting values (and sort the predictors by descending values).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">r</span><span class="m">2</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">reorder</span><span class="p">(</span><span class="n">names</span><span class="p">,</span><span class="w"> </span><span class="n">r.squared</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r.squared</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="nf">expression</span><span class="p">(</span><span class="n">R</span><span class="o">^</span><span class="p">{</span><span class="m">2</span><span class="p">}))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"predictors"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Explained variance per predictor from simple regressions"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>
<center>
<img src="https://sebastiansauer.github.io/images/2016-09-23/unnamed-chunk-4-1.png" />
</center>

<p>Wait, one more thing. Suppose we are not only interested in <script type="math/tex">R^{2}</script>, but in the p-values (OMG). How to get <em>both</em> values from <code class="highlighter-rouge">purrr</code>?.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">magrittr</span><span class="p">)</span><span class="w">

</span><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">nbaffairs</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  </span><span class="c1"># exclude outcome, leave only predictors 
</span><span class="w">  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">lm</span><span class="p">(</span><span class="n">Fair</span><span class="o">$</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">.x</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fair</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"coefficients"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map_dbl</span><span class="p">(</span><span class="m">8</span><span class="p">)</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="c1"># 8th element is the p-value 
</span><span class="w">  </span><span class="n">tidy</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">arrange</span><span class="p">(</span><span class="n">desc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">rename</span><span class="p">(</span><span class="n">p.value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">ps</span><span class="w">
  
  
</span><span class="n">kable</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">names</th>
      <th style="text-align: right">p.value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">education</td>
      <td style="text-align: right">0.9524501</td>
    </tr>
    <tr>
      <td style="text-align: left">sex</td>
      <td style="text-align: right">0.7740138</td>
    </tr>
    <tr>
      <td style="text-align: left">occupation</td>
      <td style="text-align: right">0.2245709</td>
    </tr>
    <tr>
      <td style="text-align: left">age</td>
      <td style="text-align: right">0.0195320</td>
    </tr>
    <tr>
      <td style="text-align: left">child</td>
      <td style="text-align: right">0.0107275</td>
    </tr>
    <tr>
      <td style="text-align: left">religious</td>
      <td style="text-align: right">0.0003797</td>
    </tr>
    <tr>
      <td style="text-align: left">ym</td>
      <td style="text-align: right">0.0000040</td>
    </tr>
    <tr>
      <td style="text-align: left">rate</td>
      <td style="text-align: right">0.0000000</td>
    </tr>
  </tbody>
</table>

<p>Extracting the p-value by <code class="highlighter-rouge">map_dbl(8)</code> is surely far from perfect. Any ideas how to better get the value out of this numeric 2*4 matrix? Thoughts are welcome!</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-09-22T00:00:00-04:00"><a href="https://sebastiansauer.github.io/use-boxplots/">September 22, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/use-boxplots/" rel="bookmark" title="Code example for plotting boxplots instead of mean bars" itemprop="url">Code example for plotting boxplots instead of mean bars</a></h1>
    
  </header>
  <div class="entry-content">
    <p>On a recent psychology conference I had the impression that psychologists keep preferring to show mean values, but appear less interested in more detailled plots such as the boxplot. Plots like the boxplot are richer in information, but not more difficult to perceive.</p>

<p>For those who would like to have an easy starter on how to visualize more informative plots (more than mean bars), here is a suggestion:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># install.pacakges("Ecdat")
</span><span class="n">library</span><span class="p">(</span><span class="n">Ecdat</span><span class="p">)</span><span class="w">  </span><span class="c1"># dataset on extramarital affairs
</span><span class="n">data</span><span class="p">(</span><span class="n">Fair</span><span class="p">)</span><span class="w">
</span><span class="n">str</span><span class="p">(</span><span class="n">Fair</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 'data.frame':	601 obs. of  9 variables:
##  $ sex       : Factor w/ 2 levels "female","male": 2 1 1 2 2 1 1 2 1 2 ...
##  $ age       : num  37 27 32 57 22 32 22 57 32 22 ...
##  $ ym        : num  10 4 15 15 0.75 1.5 0.75 15 15 1.5 ...
##  $ child     : Factor w/ 2 levels "no","yes": 1 1 2 2 1 1 1 2 2 1 ...
##  $ religious : int  3 4 1 5 2 2 2 2 4 4 ...
##  $ education : num  18 14 12 18 17 17 12 14 16 14 ...
##  $ occupation: int  7 6 1 6 6 5 1 4 1 4 ...
##  $ rate      : int  4 4 4 5 3 5 3 4 2 5 ...
##  $ nbaffairs : num  0 0 0 0 0 0 0 0 0 0 ...
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">

</span><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">nbaffairs</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nbaffairs</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Difference in extramarital affairs between sexes"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.5</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"firebrick"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_minimal</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-09-22-01/unnamed-chunk-1-1.png" alt="plot of chunk unnamed-chunk-1" /></p>

<p>As can be seen, the distribution information reveals some more insight than bare means: There appear to be three distinct groups of “side lookers” (persons having extramarital relations).</p>

<p>This would not come out if looking at means only:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">Fair</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">na.omit</span><span class="p">()</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">mean_affair_by_sex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">nbaffairs</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="w"> </span><span class="n">sex</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_affair_by_sex</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Mean value difference in extramarital affairs between sexes"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-09-22-01/unnamed-chunk-2-1.png" alt="plot of chunk unnamed-chunk-2" /></p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-09-22T00:00:00-04:00"><a href="https://sebastiansauer.github.io/openscience/">September 22, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~4 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/openscience/" rel="bookmark" title="How to promote open science? Some practical recommendations" itemprop="url">How to promote open science? Some practical recommendations</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I just attended the biannual <a href="http://www.dgpskongress.de">conference of the German society of psychology (DPGs)</a> in Leipzig; <a href="https://en.wikipedia.org/wiki/Open_science">open science</a> was a central, albeit not undisputed topic; a lot of interesting related <a href="https://twitter.com/hashtag/DPGs2016?src=hash">twitter discussion</a>.</p>

<p><img src="https://sebastiansauer.github.io/images/2016-09-22/2016-09-22-01.jpg" width="200" /></p>

<p>image source: <a href="https://twitter.com/nicebread303">Felix Schönbrodt</a></p>

<p>Interestingly, a strong voice of German scientiests uttered their concerns about being scooped if/when sharing their data (during the official meeting of the society). This being said (sad), the <a href="http://www.dfg.de">German research foundation (DFG)</a> has updated its guidelines now stressing (more strongly) that publicly funded projects should <a href="http://www.forschungsdaten-bildung.de/data-sharing">share their data</a>, with the rationale that the data do not belong to the individual scientiest but to the public, as the public funded it (I find that convincing). Finally, Brian Nosek had a key note talk, where he vividly argued in favor of open science; I found the talk very inspiring.</p>

<p>Anyway, I do not want to discuss the “why” and “if” but rather the “how” in this post, giving some recommendations. Or more precisely, what I personally do at the moment for living up to open science. The following list is by no means innovative, impressive, it just presents my current thinking and doing:</p>

<ul>
  <li>Share you code, e.g., on <a href="https://github.com/sebastiansauer">Github</a></li>
  <li>Spread the word (blog your thoughts), <a href="https://sebastiansauer.github.io">Github and Jekyll provide a cool tool</a></li>
  <li>Sign the (or one of the) research <a href="https://opennessinitiative.org">transparency initiatives for reviewers</a>, and live up to it</li>
  <li>Publish your data, e.g., on <a href="https://osf.io">Open Science Framework (OSF)</a></li>
  <li>Publish a data paper, e.g., <a href="https://thewinnower.com">here</a>, and get a citable paper out of in it, including a doi</li>
  <li>Checkout whether your pay-walled journal accepts <a href="http://www.sherpa.ac.uk/romeo/index.php">preprint/postprint open access</a> (many do!) (BTW: Here’s a <a href="http://blogs.scientificamerican.com/information-culture/understanding-your-rights-pre-prints-post-prints-and-publisher-versions/">blog post</a> explaining differences between preprints and postprints, and what your rights are)</li>
  <li>Put your preprint/postprint on a repository, eg., <a href="https://osf.io">OSF</a> or <a href="https://osf.io/view/socarxiv/">SocArXiv</a></li>
  <li>If you are editor or faculty head: promote open science in your environment</li>
  <li>Preregister your study, eg. on <a href="https://osf.io">OSF</a></li>
  <li>Learn more about good data (management/analysis) practices, e.g, on <a href="http://help.osf.io/m/60347/c/181281">OSF</a></li>
  <li>Connect on social media, e.g, <a href="https://twitter.com/search?q=%23openscience&amp;src=typd">Twitter</a> hashtag <code class="highlighter-rouge">#openscience</code></li>
  <li>Consider becoming an ambassador of open science at <a href="https://cos.io/contact/">COS</a></li>
</ul>

<p>Peronally, I put my code on <a href="https://github.com/sebastiansauer">Github</a>, and my data and preprints to <a href="https://osf.io/sqp7x/">OSF</a> (and other stuff, such as presentations, too). And I blog and twitter on that (among other topics).</p>

<p>The list above is surely not exhaustive, nor it is definitely mandatory to submit to each item. I am to still learning and getting more into it.</p>

<p>I think we should consider that it may well be that our research results are mostly false, see <a href="http://meehl.umn.edu/sites/g/files/pua1696/f/113theoreticalrisks.pdf">Paul Meehls seminal paper(s)</a>, and of course the results of the <a href="https://osf.io/ezcuj/">Reproducibilty Project Psychology</a>, among many others sources.</p>

<p>Hopefully, we will not drift astray in emotional discussions on “research parasites”, “methodological terrorists”, or “cyberbullies”, but focus on what is constructive for our field. One could argue that the only question that counts is “How do I contribute?”.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    
      
        <li><a href="https://sebastiansauer.github.io/page3/" class="btn">Previous</a></li>
      
    

    
    
      <li><a href="https://sebastiansauer.github.io">1</a></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="https://sebastiansauer.github.io/page2/">2</a></li>
      
    
      
        
        
        
        <li><a href="https://sebastiansauer.github.io/page3/">3</a></li>
      
    
      
        <li><strong class="current-page">4</strong></li>
      
    
      
        
        
        
        <li><a href="https://sebastiansauer.github.io/page5/">5</a></li>
      
    
      
        
        
        
        <li><a href="https://sebastiansauer.github.io/page6/">6</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="https://sebastiansauer.github.io/page9/">9</a></li>
    

    
    
      <li><a href="https://sebastiansauer.github.io/page5/" class="btn">Next</a></li>
    
  </ul>
</div>

</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Sebastian Sauer. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://sebastiansauer.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://sebastiansauer.github.io/assets/js/scripts.min.js"></script>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



          

</body>
</html>