<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Sebastian Sauer Blog</title>
<meta name="description" content="Describe this nonsense.">


<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://sebastiansauer.github.io/images/farb3.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="Describe this nonsense.">
<meta name="twitter:creator" content="@sauer_sebastian">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="https://sebastiansauer.github.io/">
<meta property="og:site_name" content="Sebastian Sauer Blog">





<link rel="canonical" href="https://sebastiansauer.github.io/">
<link href="https://sebastiansauer.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Sebastian Sauer Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="https://sebastiansauer.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="https://sebastiansauer.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="https://sebastiansauer.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="https://sebastiansauer.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="https://sebastiansauer.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://sebastiansauer.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://sebastiansauer.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://sebastiansauer.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="https://sebastiansauer.github.io/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="https://sebastiansauer.github.io/images/ses_201102_xsmall.jpg" alt="Sebastian Sauer photo" class="author-photo">
					<h4>Sebastian Sauer</h4>
					<p>Professor at FOM University of Applied Sciences. Thinker on own peril.</p>
				</li>
				<li><a href="https://sebastiansauer.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:ssauer@posteo.de"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="https://twitter.com/sauer_sebastian"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="https://linkedin.com/in/https://www.linkedin.com/in/dr-sebastian-sauer-4791762"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="https://github.com/sebastiansauer"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				<li>
					<a href="http://stackoverflow.com/users/4434263/sebastian-sauer"><i class="fa fa-fw fa-stack-exchange"></i> Stackexchange</a>
				</li>
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="https://sebastiansauer.github.io/posts/">All Posts</a></li>
				<li><a href="https://sebastiansauer.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="">Laurenz Sauer</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="https://sebastiansauer.github.io/images/farb3.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Sebastian Sauer Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-11-13T11:00:00-05:00"><a href="https://sebastiansauer.github.io/improved_bar_stacking_ggplot2_220/">November 13, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/improved_bar_stacking_ggplot2_220/" rel="bookmark" title="New bar stacking with ggplot 2.2.0" itemprop="url">New bar stacking with ggplot 2.2.0</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Recently, <code class="highlighter-rouge">ggplot2</code> 2.2.0 was released. Among other news, stacking bar plot was improved. Here is a short demonstration.</p>

<p>Load libraries</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">htmlTable</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>… and load data</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://osf.io/meyhp/?action=download"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>DOI for this piece of data is 10.17605/OSF.IO/4KGZH.</p>

<p>The data consists of results of a survey on extraversion and associated behavior.</p>

<p>Say, we would like to visualize the responsed to the extraversion items (there are 10 of them).</p>

<p>So, let’s see. First, compute summary of the responses.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data2</span><span class="w">
  
</span><span class="n">htmlTable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">data2</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">key</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">value</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">39</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">230</td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">223</td>
</tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;"></td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">6</td>
<td style="border-bottom: 2px solid grey; text-align: center;">i02</td>
<td style="border-bottom: 2px solid grey; text-align: center;">1</td>
<td style="border-bottom: 2px solid grey; text-align: center;">176</td>
</tr>
</tbody>
</table>

<p>Ok, so now let’s plot.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-03/unnamed-chunk-4-1.png" alt="plot of chunk unnamed-chunk-4" /></p>

<p>Note that <code class="highlighter-rouge">geom_col</code> is short-hand vor <code class="highlighter-rouge">geom_bar(stat = "identity")</code>.</p>

<p>Of interest, “negative” stacking is now possible.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">na.omit</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">count</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">rel_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data3</span><span class="w">



</span><span class="n">htmlTable</span><span class="p">(</span><span class="n">head</span><span class="p">(</span><span class="n">data3</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">key</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">value</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">n</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">rel_n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">-117.75</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">39</td>
<td style="text-align: center;">-85.75</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">230</td>
<td style="text-align: center;">105.25</td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: center;">i01</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">223</td>
<td style="text-align: center;">98.25</td>
</tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: center;">i02</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">176</td>
<td style="text-align: center;">51.5</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">6</td>
<td style="border-bottom: 2px solid grey; text-align: center;">i02</td>
<td style="border-bottom: 2px solid grey; text-align: center;">2</td>
<td style="border-bottom: 2px solid grey; text-align: center;">224</td>
<td style="border-bottom: 2px solid grey; text-align: center;">99.5</td>
</tr>
</tbody>
</table>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rel_n</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-03/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p>Hm, at it comes to the color, we need to change to discrete colors. It appears that the color scheme is not able (out of the box) to adapt to this “negative stacking”.</p>

<p>So:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_col</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rel_n</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-03/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">sessionInfo</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## R version 3.3.2 (2016-10-31)
## Platform: x86_64-apple-darwin13.4.0 (64-bit)
## Running under: macOS Sierra 10.12.1
## 
## locale:
## [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
## [1] purrr_0.2.2.9000 readr_1.0.0      tibble_1.2       tidyverse_1.0.0 
## [5] knitr_1.15       htmlTable_1.7    ggplot2_2.2.0    tidyr_0.6.0     
## [9] dplyr_0.5.0     
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_0.12.7         magrittr_1.5        munsell_0.4.3      
##  [4] colorspace_1.3-0    R6_2.2.0            highr_0.6          
##  [7] stringr_1.1.0       plyr_1.8.4          tools_3.3.2        
## [10] grid_3.3.2          gtable_0.2.0        DBI_0.5-1          
## [13] htmltools_0.3.5     yaml_2.1.13         lazyeval_0.2.0.9000
## [16] assertthat_0.1      digest_0.6.10       rprojroot_1.1      
## [19] rsconnect_0.5       evaluate_0.10       rmarkdown_1.1.9016 
## [22] labeling_0.3        stringi_1.1.2       scales_0.4.1       
## [25] backports_1.0.4
</code></pre>
</div>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-11-13T11:00:00-05:00"><a href="https://sebastiansauer.github.io/Crashkurs_Barplots/">November 13, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~15 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/Crashkurs_Barplots/" rel="bookmark" title="Crashkurs zur Erstellung von Barplots für Umfrage-Daten" itemprop="url">Crashkurs zur Erstellung von Barplots für Umfrage-Daten</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Eine recht häufige Art von Daten in der Wirtschaft kommen von Umfragen in der Belegschaft. Diese Daten gilt es dann aufzubereiten und graphisch wiederzugeben. Dafür gibt dieser Post einige grundlegende Hinweise. Grundwissen mit R setzen wir voraus :-)</p>

<p>Eine ausführlichere Beschreibung hier sich z.B. <a href="https://sebastiansauer.github.io/plotting_surveys/">hier</a>.</p>

<h1 id="packages-laden">Packages laden</h1>
<p>Nicht vergessen: Ein Computerprogramm (z.B. ein R-Package) kann man nur dann laden, wenn man es vorher installier hat (aber es reicht, das Programm/R-Package <em>einmal</em> zu installieren).</p>

<p>Im Paket <code class="highlighter-rouge">tidyverse</code> sind eine Reihe von Paketen gebündelt, die wir brauchen z.B. zum Diagramme erstellen (ggplot2) oder um Daten zu verhackstücken (dplyr, tidyr).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="daten-einlesen">Daten einlesen</h1>
<p>Jetzt lesen wir die Daten ein. In RStudio gibt es dafür z.B. den Button “Import Dataset”; der R-Commander hat einen ähnlichen Menüpunkt. Auch Excel-Dateien kann man so einlesen.</p>

<p>Hier laden wir mal beispielhaft einen Datensatz zu einer Online-Umfrage:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://osf.io/meyhp/?action=download"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Der DOI für diesen Datensatz ist 10.17605/OSF.IO/4KGZH.</p>

<p>Der Datensatz besteht aus 10 Extraversions-Items (<a href="https://www.zpid.de/pub/tests/PT_9006357_B5T_Forschungsbericht.pdf">B5T nach Satow</a>) sowie einigen Verhaltenskorrelaten (zumindest angenommenen). Uns interessieren also hier nur die 10 Extraversions-Items, die zusammen Extraversion als Persönlichkeitseigenschaft messen (sollen). Wir werden die Antworte der Befragten darstelle, aber uns hier keine Gedanken über Messqualität u.a. machen.</p>

<p>Die Umfrage kann <a href="https://docs.google.com/forms/d/e/1FAIpQLSfD4wQuhDV_edx1WBfN3Qos7XqoVbe41VpiKLRKtGLeuUD09Q/viewform">hier</a> eingesehen werden.</p>

<p>Schauen wir uns die Daten mal an:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">glimpse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Observations: 501
## Variables: 27
## $ timestamp          &lt;fctr&gt; 11.03.2015 19:17:48, 11.03.2015 19:18:05, ...
## $ code               &lt;fctr&gt; HSC, ERB, ADP, KHB, PTG, ABL, ber, hph, IH...
## $ i01                &lt;int&gt; 3, 2, 3, 3, 4, 3, 4, 3, 4, 4, 3, 3, 4, 4, 3...
## $ i02                &lt;int&gt; 2, 3, 1, 2, 2, 3, 1, 2, 1, 1, 2, 1, 2, 2, 2...
## $ i03                &lt;int&gt; 3, 1, 1, 2, 1, 1, 1, 2, 1, 2, 1, 1, 1, 4, 1...
## $ i04r               &lt;int&gt; 2, 3, 1, 1, 1, 1, 2, 2, 1, 1, 2, 2, 3, 1, 2...
## $ i05                &lt;int&gt; 4, 3, 4, 3, 4, 2, 3, 2, 3, 3, 3, 2, 3, 3, 3...
## $ i06                &lt;int&gt; 1, 3, 4, 2, 2, 2, 2, 3, 1, 2, 2, 2, 2, 2, 2...
## $ i07                &lt;int&gt; 3, 2, 3, 3, 4, 4, 2, 3, 3, 3, 2, 4, 2, 3, 3...
## $ i08r               &lt;int&gt; 3, 2, 3, 2, 3, 2, 2, 3, 2, 2, 2, 3, 2, 2, 1...
## $ i09                &lt;int&gt; 3, 3, 3, 3, 3, 3, 3, 4, 4, 3, 4, 2, 4, 4, 4...
## $ i10                &lt;int&gt; 1, 1, 1, 2, 4, 3, 2, 1, 2, 3, 1, 3, 2, 3, 2...
## $ n_facebook_friends &lt;int&gt; 250, 106, 215, 200, 100, 376, 180, 432, 200...
## $ n_hangover         &lt;dbl&gt; 1, 0, 0, 15, 0, 1, 1, 2, 5, 0, 1, 2, 20, 2,...
## $ age                &lt;int&gt; 24, 35, 25, 39, 29, 33, 24, 28, 29, 38, 25,...
## $ sex                &lt;fctr&gt; Frau, Frau, Frau, Frau, Frau, Mann, Frau, ...
## $ extra_single_item  &lt;int&gt; 4, 3, 4, 3, 4, 4, 3, 3, 4, 4, 4, 4, 4, 4, 4...
## $ time_conversation  &lt;dbl&gt; 10, 15, 15, 5, 5, 20, 2, 15, 10, 10, 1, 5, ...
## $ presentation       &lt;fctr&gt; nein, nein, nein, nein, nein, ja, ja, ja, ...
## $ n_party            &lt;dbl&gt; 20, 5, 3, 25, 4, 4, 3, 6, 12, 5, 10, 5, 10,...
## $ clients            &lt;fctr&gt; , , , , , , , , , , , , , , , , , , , , , ...
## $ extra_vignette     &lt;fctr&gt; , , , , , , , , , , , , , , , , , , , , , ...
## $ extra_description  &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
## $ prop_na_per_row    &lt;dbl&gt; 0.04347826, 0.04347826, 0.04347826, 0.04347...
## $ extra_mean         &lt;dbl&gt; 2.5, 2.3, 2.4, 2.3, 2.8, 2.4, 2.2, 2.5, 2.2...
## $ extra_median       &lt;dbl&gt; 3.0, 2.5, 3.0, 2.0, 3.0, 2.5, 2.0, 2.5, 2.0...
## $ n_clients          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,...
</code></pre>
</div>

<h1 id="daten-aufbereiten">Daten aufbereiten</h1>
<p>Daten aufbereiten ist ein umfangreiches Geschäft; hier schneiden wir diese Angelegenheit nur kurz an.</p>

<p>Man sollte (u.a.):</p>

<ul>
  <li>fehlende Werte identifizieren, evtl. die Fälle löschen, imputieren oder … nix tun</li>
  <li>möglich Fehleingaben identifizieren</li>
  <li>Negativ gepolte Items unkodieren</li>
  <li>Mittelwerte bilden</li>
  <li>…</li>
</ul>

<p>Statt dessen gehen wir davon aus, dass alles passt :-)</p>

<p>Eine ausführlichere Beschreibung der Aufbereitung dieser Daten findet sich <a href="https://sebastiansauer.github.io/plotting_surveys/">hier</a>.</p>

<h1 id="daten-umstellen-fr-das-plotten">Daten umstellen für das Plotten</h1>
<p>Wir haben ein Diagramm vor Augen (s.u.), bei dem auf der X-Achse die Items stehen (1,2,…,n) und auf der Y-Achse die Anzahl der Kreuze nach Kategorien.</p>

<p>Viele Grafik-Funktionen sind nun so aufgebaut, dass auf der X-Achsen nur <em>eine</em> Variable steht. <code class="highlighter-rouge">ggplot2</code>, das wir hier verwenden, ist da keine Ausnahme. Wir müssen also die “breite” Tabelle (10 Spalten, pro Item eine) in eine “lange Spalte” umbauen: Eine Spalte heißt dann “Itemnummer” und die zweite “Wert des Items” oder so ähnlich.</p>

<p>Eine ausführliche Beschreibung findet sich z.B. <a href="https://sebastiansauer.github.io/gather-long-to-wide-format/">hier</a>.</p>

<p>Also, los geht’s:</p>

<p>Zuerst wählen wir aus der Fülle der Daten, die Spalten, die uns interessieren: Die 10 Extraversions-Items, in diesem Fall.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_items</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Dann stellen wir die Daten von “breit” nach “lang” um, so dass die Items eine Variable bilden und damit für <code class="highlighter-rouge">ggplot2</code> gut zu verarbeiten sind.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gather</span><span class="p">(</span><span class="n">data_items</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">)</span><span class="w">

</span><span class="n">data_long</span><span class="o">$</span><span class="n">Antwort</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data_long</span><span class="o">$</span><span class="n">Antwort</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Den Befehl mit <code class="highlighter-rouge">factor</code> brauchen wir für zum Diagramm erstellen im Folgenden. Dieser Befehl macht aus den Zahlen bei der Variable <code class="highlighter-rouge">Antwort</code> eine nominale Variable (in R: <code class="highlighter-rouge">factor</code>) mit Text-Werten “1”, “2” und so weiter. Wozu brauchen wir das? Der Digrammbefehl unten kann nur mit nominalen Variablen Gruppierungen durchführen. Wir werden in dem Diagramm die Anzahl der Antworten darstellen - die Anzahl der Antworten nach Antwort-Gruppe (Gruppe mit Antwort “1” etc.).</p>

<p>Keine Sorge, wenn sich das reichlich ungewöhnlich anhört. Sie müssen es an dieser Stelle nicht erfinden :-)</p>

<p>Man gewöhnt sich daran einerseits; und andererseits ist es vielleicht auch so, dass diese Funktionen nicht perfekt sind, oder nicht aus unserer Sicht oder nur aus Sicht des Menschen, der die Funktion geschrieben hat. Jedenfalls brauchen wir hier eine <code class="highlighter-rouge">factor</code> Variable zur Gruppierung…</p>

<p>Damit haben wir es schon! Jetzt wird gemalt.</p>

<h1 id="erste-diagramme">Erste Diagramme</h1>

<p>Wir nutzen <code class="highlighter-rouge">ggplot2</code>, wie gesagt, und davon die Funktion <code class="highlighter-rouge">qplot</code> (q wie quick, nehme ich an.).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" /></p>

<p>Was macht dieser <code class="highlighter-rouge">ggplot</code> Befehl? Schauen wir es uns in Einzelnen an:</p>

<ul>
  <li><code class="highlighter-rouge">ggplot(data = ...)</code>: Wir sagen “Ich möchte gern die Funktion ggplot nutzen, um den Datensatz … zu plotten”.</li>
  <li><code class="highlighter-rouge">aes(...)</code>: Hier definieren wir die “aesthetics” des Diagramms, d.h. alles “Sichtbare”. Wir ordnen in diesem Fall der X-Achse die Variable <code class="highlighter-rouge">items</code> zu. Per Standardeinstellung geht <code class="highlighter-rouge">ggplot</code> davon aus, dass sie die Häufigkeiten der X-Werte auf der Y-Achse haben wollen, wenn Sie nichts über die Y-Achse sagen. Jetzt haben wir ein Koordinatensystem definiert (das noch leer ist).</li>
  <li><code class="highlighter-rouge">geom_bar()</code>: “Hey R oder ggplot, jetzt male mal einen barplot in den ansonsten noch leeren plot”.</li>
  <li><code class="highlighter-rouge">aes(fill = Antwort)</code>: Genauer gesagt nutzen wir <code class="highlighter-rouge">aes</code> um einen sichtbaren Aspekte des Diagramms (wie die X-Achse) eine Variable des Datensatzes zuzuordnen. Jetzt sagen wir, dass die Füllung (im Balkendiagramm) durch die Werte von <code class="highlighter-rouge">Antwort</code> definiert sein sollen (also “1”, “2” etc.).</li>
  <li><code class="highlighter-rouge">position = "fill"</code> sagt, dass die Gesamt-Höhe des Balken aufgeteilt werden soll mit den “Teil-Höhen” der Gruppen (Antwort-Kategorien 1 bis 4); wir hätten die Teil-Höhen auch nebeneinander stellen können.</li>
</ul>

<h1 id="nas-entfernen">Nas entfernen</h1>
<p>Vielleicht ist es schöner, die NAs erst zu entfernen.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_long</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">na.omit</span><span class="p">(</span><span class="n">data_long</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Und dann noch mal plotten:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /></p>

<h1 id="um-90-drehen">Um 90° drehen</h1>

<p>Dazu nehmen wir <code class="highlighter-rouge">+ coord_flip()</code>, also “flippe das Koordinatensystem”.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-9-1.png" alt="plot of chunk unnamed-chunk-9" /></p>

<h1 id="text-labels-fr-die-items">Text-Labels für die Items</h1>

<p>Wir definieren die Texte (“Labels”) für die Items:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">item_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Ich bin das erste Item"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"Das zweite Item"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"Item 3 sdjfkladsjk"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"Ich bin ein krasser Couch-Potato UMKODIERT"</span><span class="p">,</span><span class="w">
</span><span class="s2">"i5 asf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"i6 sdf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adfjks"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sfjlkd"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sdfkjl"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sdfjkl"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Jetzt hängen wir die Labels an die Items im Diagramm:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item_labels</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<p>Man kann auch einen Zeilenumbruch in den Item-Labels erzwingen… wobei das führt uns schon recht weit, aber gut, zum Abschluss :-)</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">item_labels</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"Ich bin das erste Item"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"Das zweite Item"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"Item 3 sdjfkladsjk"</span><span class="p">,</span><span class="w">
                 </span><span class="s2">"Ich bin ein krasser \nCouch-Potato***mit Zeilenumbruch***"</span><span class="p">,</span><span class="w">
</span><span class="s2">"i5 asf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"i6 sdf"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adfjks"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sfjlkd"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sdfkjl"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sdfjkl"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Und wieder plotten:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item_labels</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Extraversionsitems"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Anteile"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<h1 id="diagramm-mit-hufigkeiten-nicht-anteilen">Diagramm mit Häufigkeiten, nicht Anteilen</h1>
<p>Ach so, schön wäre noch die echten Zahlen an der Y-Achse, nicht Anteile. Dafür müssen wir unseren Diagrammtyp ändern, bzw. die Art der Anordnung ändern. Mit <code class="highlighter-rouge">position = "fill"</code> wird der Anteil (also mit einer Summe von 100%) dargestellt. Wir können auch einfach die Zahlen/Häufigkeiten anzeigen, in dem wir die Kategorien “aufeinander stapeln”</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item_labels</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<h1 id="farbschema">Farbschema</h1>
<p>Ja, die Wünsche hören nicht auf… Also, noch ein anderes Farbschema:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data_long</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Antwort</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"stack"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">item_labels</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13-02/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /></p>

<p>Probieren Sie mal ein paar Brewer Farbpaletten aus.</p>

<p>Natürlich kann man noch viel mehr tun; schauen Sie sich z.B. dieses ausführlichere Posting an: https://sebastiansauer.github.io/plotting_surveys/.</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-11-12T11:00:00-05:00"><a href="https://sebastiansauer.github.io/overfitting_simulation/">November 12, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~13 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/overfitting_simulation/" rel="bookmark" title="Some thoughts (and simulation) on overfitting" itemprop="url">Some thoughts (and simulation) on overfitting</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Overfitting is a common problem in data analysis. Some go as far as saying that “most of” published research is false (John Ionnadis); overfitting being one, maybe central, problem of it. In this post, we explore some aspects on the notion of overfitting.</p>

<p>Assume we have 10 metric variables <code class="highlighter-rouge">v</code> (personality/health/behavior/gene indicator variables), and, say, 10 variables for splitting up subgroups (aged vs. young, female vs. male, etc.), so 10 dichotomic variables. Further assume there are no association whatsoever between these variables. How likely is it we find something publishable? Apparently quite probably; but let’s give it a try.</p>

<p>Load some packages.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">corrr</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">htmlTable</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="simulated-dataset-10x10">Simulated dataset 10x10</h1>
<p>Make sup some uncorrelated data, 10x10 variables each <script type="math/tex">N \sim (0,1)</script>.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="w">
</span></code></pre>
</div>

<p>Let’s visualize the correlation matrix.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">correlate</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rearrange</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rplot</span><span class="p">(</span><span class="n">print_cor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/corr_matrix_1-1.png" alt="plot of chunk corr_matrix_1" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">correlate</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v_corr_matrix</span><span class="w">
</span></code></pre>
</div>

<p>So, quite some music in the bar. Let’s look at the distribution of the correlation coefficients.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v_corr_matrix</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">rowname</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v_long</span><span class="w">
  
</span><span class="n">v_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">r_binned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cut_width</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_binned</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_bar</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/corr_distrib-1.png" alt="plot of chunk corr_distrib" /></p>

<p>What about common statistics?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">psych</span><span class="p">)</span><span class="w">
</span><span class="n">describe</span><span class="p">(</span><span class="n">v_long</span><span class="o">$</span><span class="n">value</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##    vars  n  mean   sd median trimmed  mad   min  max range skew kurtosis
## X1    1 90 -0.03 0.36  -0.12   -0.05 0.35 -0.68 0.77  1.44 0.36    -0.68
##      se
## X1 0.04
</code></pre>
</div>

<p>Probably more stringent to just choose one triangle from the matrix, but I think it does not really matter for our purposes.</p>

<p>Quite a bit of substantial correlation going on. Let’s look from a different angle.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v_long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_violin</span><span class="p">(</span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.1</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">v_long</span><span class="o">$</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#880011"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/violin_plot-1.png" alt="plot of chunk violin_plot" /></p>

<h2 id="x100-dataset-correlation">100x100 dataset correlation</h2>

<p>Now let’s scale up a bit and see whether the pattern stabilize.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">10</span><span class="o">^</span><span class="m">4</span><span class="p">),</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="m">2</span><span class="w">
</span><span class="n">v</span><span class="m">2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">correlate</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="m">2</span><span class="err">_</span><span class="n">corr_matrix</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="m">2</span><span class="err">_</span><span class="n">corr_matrix</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">rowname</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="m">2</span><span class="err">_</span><span class="n">long</span><span class="w">
  
</span><span class="n">v</span><span class="m">2</span><span class="err">_</span><span class="n">long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">r_binned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cut_width</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r_binned</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">..count..</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">..count..</span><span class="p">)))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"proportion"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/histo1-1.png" alt="plot of chunk histo1" /></p>

<p>So, how many r’s are in the (0.1,0.3) bin?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span><span class="w">
</span><span class="n">v</span><span class="m">2</span><span class="err">_</span><span class="n">long</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">r_binned</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cut_width</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="m">0.2</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">r_binned</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">n_per_bin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w">
            </span><span class="n">prop_per_bin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">n</span><span class="p">()</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">.</span><span class="p">),</span><span class="w"> </span><span class="m">2</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 5 × 3
##      r_binned n_per_bin prop_per_bin
##        &lt;fctr&gt;     &lt;int&gt;        &lt;dbl&gt;
## 1 [-0.5,-0.3]        10         0.00
## 2 (-0.3,-0.1]      1594         0.16
## 3  (-0.1,0.1]      6776         0.68
## 4   (0.1,0.3]      1512         0.15
## 5   (0.3,0.5]         8         0.00
</code></pre>
</div>

<p>That’s quite a bit; 15% correlation in the bin (.1.3). Publication ahead!</p>

<h1 id="subgroup-analyses">Subgroup analyses</h1>

<p>Now, let’s look at our subgroup. For that purposes, we need actual data, not only the correlation data. Let’s come up with 1000 individuals, where he have 100 measurement (metric; N(0,1)), and 100 subgroup variables (dichotomic).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">123</span><span class="p">)</span><span class="w">
</span><span class="n">matrix</span><span class="p">(</span><span class="n">rnorm</span><span class="p">(</span><span class="m">1000</span><span class="o">*</span><span class="m">100</span><span class="p">),</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="m">3</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">v</span><span class="m">3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 1000  100
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">matrix</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="o">*</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">replace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">nrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="m">4</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">v</span><span class="m">4</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 1000  100
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="m">5</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">v</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="m">4</span><span class="p">)</span><span class="w">
</span><span class="nf">dim</span><span class="p">(</span><span class="n">v</span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 1000  200
</code></pre>
</div>

<p>Now, t-test battle. For each variable, compute a t-test; for each subgroup, compute a t-test. Do the whole shabeng (100*100 tests).</p>

<p>But, as a first step, let’s look at the first subgroup variable only.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="m">3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">data.frame</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">t.test</span><span class="p">(</span><span class="n">.x</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">v</span><span class="m">4</span><span class="p">[,</span><span class="w"> </span><span class="m">1</span><span class="p">]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">broom</span><span class="o">::</span><span class="n">tidy</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="s2">"p.value"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">unlist</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">tibble</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">v</span><span class="m">3</span><span class="err">_</span><span class="n">pvalues</span><span class="w">

</span><span class="n">v</span><span class="m">3</span><span class="err">_</span><span class="n">pvalues</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"p value"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_vline</span><span class="p">(</span><span class="n">xintercept</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.05</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"#880011"</span><span class="p">,</span><span class="w"> </span><span class="n">linetype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dashed"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Don't know how to automatically pick scale for object of type tbl_df/tbl/data.frame. Defaulting to continuous.
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/shabeng_1st-1.png" alt="plot of chunk shabeng_1st" /></p>

<p>How many significant p values resulted (should be 5%, ie 5 of 100)?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">v</span><span class="m">3</span><span class="err">_</span><span class="n">pvalues</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">.</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">.05</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 5 × 1
##            .
##        &lt;dbl&gt;
## 1 0.01350926
## 2 0.04115726
## 3 0.01064116
## 4 0.04251559
## 5 0.02505199
</code></pre>
</div>

<p>Which is exactly what we found.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_list</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">vector</span><span class="p">(</span><span class="n">length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">mode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"list"</span><span class="p">)</span><span class="w">
</span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="m">1</span><span class="w">

</span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">){</span><span class="w">
  
  </span><span class="n">v</span><span class="m">3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">data.frame</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">map</span><span class="p">(</span><span class="o">~</span><span class="n">t.test</span><span class="p">(</span><span class="n">.x</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">v</span><span class="m">4</span><span class="p">[,</span><span class="w"> </span><span class="n">i</span><span class="p">]))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">map</span><span class="p">(</span><span class="n">broom</span><span class="o">::</span><span class="n">tidy</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">map</span><span class="p">(</span><span class="s2">"p.value"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
    </span><span class="n">unlist</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
    </span><span class="n">tibble</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p_list</span><span class="p">[[</span><span class="n">i</span><span class="p">]]</span><span class="w">
  
</span><span class="p">}</span><span class="w">

</span><span class="c1"># str(p_list)  #tl;dr
</span><span class="w">
</span><span class="n">p_df</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">as.data.frame</span><span class="p">(</span><span class="n">p_list</span><span class="p">)</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">p_df</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"V"</span><span class="p">,</span><span class="w"> </span><span class="n">formatC</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">100</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0"</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Let’s try a giant plot with 100 small multiples.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_histogram</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">key</span><span class="p">,</span><span class="w"> </span><span class="n">ncol</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/giant_plot-1.png" alt="plot of chunk giant_plot" /></p>

<p>Well impressive, but that histogram matrix does not serve much. What about a correlation plot as above, only giantesque…</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">correlate</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">rplot</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/corr_plot_giant-1.png" alt="plot of chunk corr_plot_giant" /></p>

<p>Hm, of artis values (in 10000 years). Maybe better plot a histogram of the number of signifinat p-values ( &lt;. 05).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">filter</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">.05</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"p value"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/hist3-1.png" alt="plot of chunk hist3" /></p>

<p>In exact numbers, what’s the percentage of significant p-values per variable?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">.05</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p_significant</span><span class="w">
</span></code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">htmlTable</span><span class="p">(</span><span class="n">p_significant</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">key</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">n</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;">1</td>
<td style="text-align: center;">V001</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">2</td>
<td style="text-align: center;">V002</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">3</td>
<td style="text-align: center;">V003</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">4</td>
<td style="text-align: center;">V004</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">5</td>
<td style="text-align: center;">V005</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">6</td>
<td style="text-align: center;">V006</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">7</td>
<td style="text-align: center;">V007</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">8</td>
<td style="text-align: center;">V008</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">9</td>
<td style="text-align: center;">V009</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">10</td>
<td style="text-align: center;">V010</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">11</td>
<td style="text-align: center;">V011</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">12</td>
<td style="text-align: center;">V012</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">13</td>
<td style="text-align: center;">V013</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">14</td>
<td style="text-align: center;">V014</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">15</td>
<td style="text-align: center;">V015</td>
<td style="text-align: center;">13</td>
</tr>
<tr>
<td style="text-align: left;">16</td>
<td style="text-align: center;">V016</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">17</td>
<td style="text-align: center;">V017</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">18</td>
<td style="text-align: center;">V018</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">19</td>
<td style="text-align: center;">V019</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">20</td>
<td style="text-align: center;">V020</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">21</td>
<td style="text-align: center;">V021</td>
<td style="text-align: center;">10</td>
</tr>
<tr>
<td style="text-align: left;">22</td>
<td style="text-align: center;">V022</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">23</td>
<td style="text-align: center;">V023</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">24</td>
<td style="text-align: center;">V024</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">25</td>
<td style="text-align: center;">V025</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">26</td>
<td style="text-align: center;">V026</td>
<td style="text-align: center;">9</td>
</tr>
<tr>
<td style="text-align: left;">27</td>
<td style="text-align: center;">V027</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">28</td>
<td style="text-align: center;">V028</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">29</td>
<td style="text-align: center;">V029</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">30</td>
<td style="text-align: center;">V030</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">31</td>
<td style="text-align: center;">V031</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">32</td>
<td style="text-align: center;">V032</td>
<td style="text-align: center;">9</td>
</tr>
<tr>
<td style="text-align: left;">33</td>
<td style="text-align: center;">V033</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">34</td>
<td style="text-align: center;">V034</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">35</td>
<td style="text-align: center;">V035</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">36</td>
<td style="text-align: center;">V036</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">37</td>
<td style="text-align: center;">V037</td>
<td style="text-align: center;">11</td>
</tr>
<tr>
<td style="text-align: left;">38</td>
<td style="text-align: center;">V038</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">39</td>
<td style="text-align: center;">V039</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">40</td>
<td style="text-align: center;">V040</td>
<td style="text-align: center;">10</td>
</tr>
<tr>
<td style="text-align: left;">41</td>
<td style="text-align: center;">V041</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">42</td>
<td style="text-align: center;">V042</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">43</td>
<td style="text-align: center;">V043</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">44</td>
<td style="text-align: center;">V044</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">45</td>
<td style="text-align: center;">V045</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">46</td>
<td style="text-align: center;">V046</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">47</td>
<td style="text-align: center;">V047</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">48</td>
<td style="text-align: center;">V048</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">49</td>
<td style="text-align: center;">V049</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">50</td>
<td style="text-align: center;">V050</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">51</td>
<td style="text-align: center;">V051</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">52</td>
<td style="text-align: center;">V052</td>
<td style="text-align: center;">10</td>
</tr>
<tr>
<td style="text-align: left;">53</td>
<td style="text-align: center;">V053</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">54</td>
<td style="text-align: center;">V054</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">55</td>
<td style="text-align: center;">V055</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">56</td>
<td style="text-align: center;">V056</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">57</td>
<td style="text-align: center;">V057</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">58</td>
<td style="text-align: center;">V058</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">59</td>
<td style="text-align: center;">V059</td>
<td style="text-align: center;">1</td>
</tr>
<tr>
<td style="text-align: left;">60</td>
<td style="text-align: center;">V060</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">61</td>
<td style="text-align: center;">V062</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">62</td>
<td style="text-align: center;">V063</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">63</td>
<td style="text-align: center;">V064</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">64</td>
<td style="text-align: center;">V065</td>
<td style="text-align: center;">12</td>
</tr>
<tr>
<td style="text-align: left;">65</td>
<td style="text-align: center;">V066</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">66</td>
<td style="text-align: center;">V067</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">67</td>
<td style="text-align: center;">V068</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">68</td>
<td style="text-align: center;">V069</td>
<td style="text-align: center;">9</td>
</tr>
<tr>
<td style="text-align: left;">69</td>
<td style="text-align: center;">V070</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">70</td>
<td style="text-align: center;">V071</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">71</td>
<td style="text-align: center;">V072</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">72</td>
<td style="text-align: center;">V073</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">73</td>
<td style="text-align: center;">V074</td>
<td style="text-align: center;">8</td>
</tr>
<tr>
<td style="text-align: left;">74</td>
<td style="text-align: center;">V075</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">75</td>
<td style="text-align: center;">V076</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">76</td>
<td style="text-align: center;">V077</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">77</td>
<td style="text-align: center;">V078</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">78</td>
<td style="text-align: center;">V079</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">79</td>
<td style="text-align: center;">V080</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">80</td>
<td style="text-align: center;">V081</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">81</td>
<td style="text-align: center;">V082</td>
<td style="text-align: center;">9</td>
</tr>
<tr>
<td style="text-align: left;">82</td>
<td style="text-align: center;">V083</td>
<td style="text-align: center;">12</td>
</tr>
<tr>
<td style="text-align: left;">83</td>
<td style="text-align: center;">V084</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">84</td>
<td style="text-align: center;">V085</td>
<td style="text-align: center;">3</td>
</tr>
<tr>
<td style="text-align: left;">85</td>
<td style="text-align: center;">V086</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">86</td>
<td style="text-align: center;">V087</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">87</td>
<td style="text-align: center;">V088</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">88</td>
<td style="text-align: center;">V089</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">89</td>
<td style="text-align: center;">V090</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">90</td>
<td style="text-align: center;">V091</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">91</td>
<td style="text-align: center;">V092</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">92</td>
<td style="text-align: center;">V093</td>
<td style="text-align: center;">4</td>
</tr>
<tr>
<td style="text-align: left;">93</td>
<td style="text-align: center;">V094</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="text-align: left;">94</td>
<td style="text-align: center;">V095</td>
<td style="text-align: center;">2</td>
</tr>
<tr>
<td style="text-align: left;">95</td>
<td style="text-align: center;">V096</td>
<td style="text-align: center;">10</td>
</tr>
<tr>
<td style="text-align: left;">96</td>
<td style="text-align: center;">V097</td>
<td style="text-align: center;">7</td>
</tr>
<tr>
<td style="text-align: left;">97</td>
<td style="text-align: center;">V098</td>
<td style="text-align: center;">6</td>
</tr>
<tr>
<td style="text-align: left;">98</td>
<td style="text-align: center;">V099</td>
<td style="text-align: center;">5</td>
</tr>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">99</td>
<td style="border-bottom: 2px solid grey; text-align: center;">V100</td>
<td style="border-bottom: 2px solid grey; text-align: center;">2</td>
</tr>
</tbody>
</table>

<p>Distribution of significant p-values.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_significant</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">.</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-13/histo_p_values-1.png" alt="plot of chunk histo_p_values" /></p>

<p>Summary stats of significant p-values.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_df</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="m">.05</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">n_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">(),</span><span class="w">
            </span><span class="n">mean_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
            </span><span class="n">median_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
            </span><span class="n">sd_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">IQP_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">IQR</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
            </span><span class="n">min_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">min</span><span class="p">(</span><span class="n">value</span><span class="p">),</span><span class="w">
            </span><span class="n">max_p</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">map</span><span class="p">(</span><span class="n">mean</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">as.data.frame</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p_summary_tab</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning in mean.default(.x[[i]], ...): argument is not numeric or logical:
## returning NA
</code></pre>
</div>

<p>Here comes the table of the <em>mean</em> over all 100 variables of the typical statistics.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p_summary_tab</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select_if</span><span class="p">(</span><span class="n">is.numeric</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">round</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">htmlTable</span><span class="w">
</span></code></pre>
</div>

<table class="gmisc_table" style="border-collapse: collapse; margin-top: 1em; margin-bottom: 1em;">
<thead>
<tr>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey;"> </th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">key</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">n_p</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">mean_p</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">median_p</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">sd_p</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">IQP_p</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">min_p</th>
<th style="border-bottom: 1px solid grey; border-top: 2px solid grey; text-align: center;">max_p</th>
</tr>
</thead>
<tbody>
<tr>
<td style="border-bottom: 2px solid grey; text-align: left;">1</td>
<td style="border-bottom: 2px solid grey; text-align: center;"></td>
<td style="border-bottom: 2px solid grey; text-align: center;">6</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;"></td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
<td style="border-bottom: 2px solid grey; text-align: center;">0</td>
</tr>
</tbody>
</table>

<p>In sum, overfitting - mistakenly taking noise as signal - happened often. Actually, as often as is expected by theory. But, not knowing or not minding theory, one can easily be surprised by the plethora of “interesting findings” in the data. In John Tukey’s words (more or less): “Torture the data for a long enough time and it will tell you anything”.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-11-10T11:00:00-05:00"><a href="https://sebastiansauer.github.io/plotting_surveys/">November 10, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~29 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/plotting_surveys/" rel="bookmark" title="Preparing and plotting survey results" itemprop="url">Preparing and plotting survey results</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Plotting (and more generally, analyzing) survey results is a frequent endeavor. Let’s not think about arguments whether and when surveys are useful (for some recent criticism see the <a href="http://www.springer.com/de/book/9783319397559">Briggs’ book</a>.</p>

<p>Typically, respondents circle some option ranging from “don’t agree at all” to “completely agree” for each question (or “item”). Typically, four to six boxes are given where one is expected to tick one.</p>

<p>In this tutorial, I will discuss some barplot type visualizations. Sure, much more can be done, but we will stick to this one plot for this post.</p>

<p>Some needed packages.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">forcats</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="prepare-data">Prepare data</h1>

<p>So, first, let’s load some data. That’s a data set of a survey on extraversion. Folks were asked a bunch of questions tapping at their “psychometric extraversion”, and some related behavior, that is, behavior <em>supposed to</em> be related such as “number of Facebook friends”, “how often at a party” etc. Note that college students form the sample.</p>

<p>Data are available only (free as in free and free as in beer).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://sebastiansauer.github.io/data/extra_raw_WS16.csv"</span><span class="p">)</span><span class="w">

</span><span class="n">data_raw</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data</span><span class="w">  </span><span class="c1"># backup just in case
</span></code></pre>
</div>

<p>OK, we got ‘em; a dataset of dimension 501, 24. Let’s glimpse at the data:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">glimpse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Observations: 501
## Variables: 24
## $ Zeitstempel                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            &lt;fctr&gt; ...
## $ Bitte.geben.Sie.Ihren.dreistellen.anonymen.Code.ein..1...Anfangsbuchstabe.des.Vornamens.Ihres.Vaters..2...Anfangsbuchstabe.des.Mädchennamens.Ihrer.Mutter..3..Anfangsbuchstabe.Ihres.Geburstsorts.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     &lt;fctr&gt; ...
## $ Ich.bin.gerne.mit.anderen.Menschen.zusammen.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           &lt;int&gt; ...
## $ Ich.bin.ein.Einzelgänger.....                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          &lt;int&gt; ...
## $ Ich.bin.in.vielen.Vereinen.aktiv.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      &lt;int&gt; ...
## $ Ich.bin.ein.gesprächiger.und.kommunikativer.Mensch.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    &lt;int&gt; ...
## $ Ich.bin.sehr.kontaktfreudig.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           &lt;int&gt; ...
## $ Im.Grunde.bin.ich.oft.lieber.für.mich.allein.....                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      &lt;int&gt; ...
## $ Ich.kann.schnell.gute.Stimmung.verbreiten.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             &lt;int&gt; ...
## $ Ich.gehe.gerne.auf.Partys.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             &lt;int&gt; ...
## $ Ich.bin.unternehmungslustig.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           &lt;int&gt; ...
## $ Ich.stehe.gerne.im.Mittelpunkt.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        &lt;int&gt; ...
## $ Wie.viele.Facebook.Freunde..Kontakte..haben.Sie..wenn.Sie.nicht.bei.Facebook.sind..bitte.LEER.lassen..                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 &lt;int&gt; ...
## $ Wie.viele..Kater...überreichlicher.Alkoholkonsum..hatten.Sie.in.den.letzten12.Monaten.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 &lt;fctr&gt; ...
## $ Wie.alt.sind.Sie.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      &lt;int&gt; ...
## $ Bitte.geben.Sie.Ihr.Geschlecht.an.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     &lt;fctr&gt; ...
## $ Ich.würde.sagen..ich.bin.extrovertiert.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                &lt;int&gt; ...
## $ Sie.gehen.alleine.auf.eine.Party..Nach.wie.viel.Minuten.sind.Sie.im.Gespräch.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          &lt;fctr&gt; ...
## $ Es.wird.ein.Mitarbeiter..m.w..für.eine.Präsentation..Messe..gesucht..Melden.Sie.sich.freiwillig.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       &lt;fctr&gt; ...
## $ Wie.häufig.waren.Sie.in.den.letzten.12.Monaten.auf.einer.Party.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        &lt;fctr&gt; ...
## $ Wie.oft.haben.Sie.Kundenkontakt.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       &lt;fctr&gt; ...
## $ Passt.die.folgende.Beschreibung.auf.Sie...........Eine.extravertierte.Person.ist.jemand..der.seine.Energie.eher.nach.außen.richtet.und.weniger.in.die.innere.Welt.der.Gedanken..Ideen.oder.Vorstellungen..Daher.neigen.extravertierte.Menschen.dazu..in.neuen.Situationen.ohne.zu.zögern.sich.in.die.neue.Situationen.zu.begeben..Zum.Beispiel.würde.eine.extravertierte.Person..die.zum.ersten.Mal.einen.Yogakurs.besucht..sich.nicht.scheuen..direkt.bei.den.Übungen.mitzumachen..Oder.wenn.eine.extravertierte.Person.eine.Kneipe.zum.ersten.besucht..würde.sie.sich.nicht.unbehaglich.fühlen..Man.kann.daher.sagen..dass.extravertierte.Personen.als.aktiv.wahrgenommen.werden.und.sich.zu.Unternehmungen.hingezogen.fühlen..bei.denen.sie.mit.anderen.Personen.in.Kontakt.kommen. &lt;fctr&gt; ...
## $ X                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      &lt;lgl&gt; ...
## $ Wie.sehr.treffen.die.folgenden.Aussagen.auf.Sie.zu..Bitte.denken.Sie.dabei.nicht.an.spezifische.Situationen..sondern.ganz.allgemein..wie.sehr.die.Aussagen.Sie.selbst.in.den.meisten.Bereichen.und.Situationen.in.Ihrem.Leben.beschreiben.Allgemein.wirke.ich.tendenziell.eher.wie.eine.Person..die......                                                                                                                                                                                                                                                                                                                                                                                                                                                                              &lt;int&gt; ...
</code></pre>
</div>

<h2 id="renaming">Renaming</h2>
<p>Looks like a jungle. Now what? Let’s start with renaming the columns (variables).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">extra_colnames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">  </span><span class="c1"># save names in this vector
</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">3</span><span class="o">:</span><span class="m">12</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">paste</span><span class="p">(</span><span class="s2">"i"</span><span class="p">,</span><span class="w"> </span><span class="n">formatC</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">flag</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"0"</span><span class="p">),</span><span class="w"> </span><span class="n">sep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">""</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p>Now columns 3 to 12 are now named “i1”, “i2”, etc. These columns reflect the items of a extraversion questionnaire.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">1</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"timestamp"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">2</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"code"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">13</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"n_facebook_friends"</span><span class="w"> 
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">14</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"n_hangover"</span><span class="w"> 
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">15</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"age"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">16</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"sex"</span><span class="w"> 
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">17</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"extra_single_item"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">18</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"time_conversation"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">19</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"presentation"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">20</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"n_party"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">21</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"clients"</span><span class="w">
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">22</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"extra_vignette"</span><span class="w"> 
</span><span class="nf">names</span><span class="p">(</span><span class="n">data</span><span class="p">)[</span><span class="m">24</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"extra_description"</span><span class="w"> 
</span><span class="n">data</span><span class="o">$</span><span class="n">X</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NULL</span><span class="w">
</span></code></pre>
</div>

<h2 id="recoding">Recoding</h2>
<p>Importantly, two items are negatively coded; we need to recode them (ie., “yes” gets “no”, and vice versa).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">rename</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> 
       </span><span class="n">i</span><span class="m">04</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="m">04</span><span class="p">,</span><span class="w">
       </span><span class="n">i</span><span class="m">08</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="m">08</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="w">

</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">i</span><span class="m">04</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">i</span><span class="m">04</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">`1`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4L</span><span class="p">,</span><span class="w"> </span><span class="n">`2`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3L</span><span class="p">,</span><span class="w"> </span><span class="n">`3`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2L</span><span class="p">,</span><span class="w"> </span><span class="n">`4`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1L</span><span class="p">),</span><span class="w">
         </span><span class="n">i</span><span class="m">08</span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">i</span><span class="m">08</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">`1`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4L</span><span class="p">,</span><span class="w"> </span><span class="n">`2`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3L</span><span class="p">,</span><span class="w"> </span><span class="n">`3`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2L</span><span class="p">,</span><span class="w"> </span><span class="n">`4`</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1L</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="w">
</span></code></pre>
</div>

<p>I suspect there are rows with <em>no</em> values at, complete blank. Let’s compute the proportion of NAs per row.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">rowSums</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   [1]  1  1  1  1  1  1  1  1  1  2  1  1  1  1  1  1  1  2  1  1  1  1  1
##  [24]  2  1  2  2  1  1  1  1  1  1  1  1  1  1  2  1  2  1  1  1  1  1  1
##  [47]  1  1  2  1  1  3  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1  1
##  [70]  1  1  1  1  1  1  1  2  1  1  1  1  1  1  1  1  1  1  1  1  2  2  1
##  [93]  1  2  1  1  1  2  2  1  1  2  1  1  3  1  1  1  1  2  1  2  1  1  1
## [116]  0  0  0  0  0  0  0  1  0  0  0  0  0  0  0  0  1  0  0  1  0  1  0
## [139]  1  0  0  1  0  0  0  0  0  0  1  0  0  0  0  0  0  0  0  1  0  0  2
## [162]  0  0  0  0  0  1  1  0  0  0  0  0  0  1  0  1  0  1  0  0  1  1  1
## [185]  1  0  3  0  2  0  0  0  0  0  0  1  1  0  0  0  0  1  1  0  0  0  0
## [208]  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  1  0  0  0  1  1
## [231]  1  1  0  1  1  0  1  1  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0
## [254]  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0  1  0  0  0  0  0  0  0
## [277]  0  1  0  1  0  0  0  1  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0
## [300]  0  0  0  0  0  0  1  0  0  1  0  0  0  0  0  0  2  0  0  0  0  0  0
## [323]  1  0  0  1  0  0  0  0  0  0  0  1  0  0  0  0  0  0  1  1  0  0  0
## [346]  0  0  0  1  0  0  2  0  0  0  0  1  1  0  0  0  0  0  0  0  0  1  0
## [369]  0  0  1  0  0  0  0  0  0  0  1  1  0  0  0  0  1  0  0  0  0  0  1
## [392]  0  1  0  1  0  0  0  0  0  0  0  0  0  0  0  0  0  0  1  0  0  0  0
## [415]  0  0  0  0  0  0  0  0  0  0  1  1  0  0  0  0  0  0  0  1  0  0  0
## [438]  0  0  0  1  1  0  1  0  0  0  0  0  0  0  0 14  1  1  0  1  0  1  0
## [461]  0  0  0  0  0 11  0  0  0  1  0  0  0  1  1  0  1  1  0  0  0  0  0
## [484]  0  0  0  0  0  0  0  0  0  0  0  0  1  1  0  0  1  0
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">table</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">extra_description</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
##   1   2   3   4   5   6   7   8  10 
##  31 118  98  68  44  12   5   1   1
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">prop_na_per_row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowSums</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="o">/</span><span class="n">ncol</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="w">

</span><span class="n">count</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">prop_na_per_row</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 6 × 2
##   prop_na_per_row     n
##             &lt;dbl&gt; &lt;int&gt;
## 1      0.00000000   304
## 2      0.04347826   171
## 3      0.08695652    21
## 4      0.13043478     3
## 5      0.47826087     1
## 6      0.60869565     1
</code></pre>
</div>

<h2 id="rowwise-means-for-survey-etc">Rowwise means for survey etc.</h2>
<p>Let’s compute the mean and the median extraversion.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">extra_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rowMeans</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="m">12</span><span class="p">],</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
         </span><span class="n">extra_median</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">.</span><span class="p">[</span><span class="m">3</span><span class="o">:</span><span class="m">12</span><span class="p">],</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="w">
</span></code></pre>
</div>

<h2 id="cleaning-data">Cleaning data</h2>
<p>The number of hangovers should be numeric, but it isn’t. Let’s see.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">count</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">n_hangover</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: left">n_hangover</th>
      <th style="text-align: right">n</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"> </td>
      <td style="text-align: right">13</td>
    </tr>
    <tr>
      <td style="text-align: left">0</td>
      <td style="text-align: right">98</td>
    </tr>
    <tr>
      <td style="text-align: left">1</td>
      <td style="text-align: right">59</td>
    </tr>
    <tr>
      <td style="text-align: left">10</td>
      <td style="text-align: right">38</td>
    </tr>
    <tr>
      <td style="text-align: left">100</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">106</td>
      <td style="text-align: right">4</td>
    </tr>
    <tr>
      <td style="text-align: left">12</td>
      <td style="text-align: right">18</td>
    </tr>
    <tr>
      <td style="text-align: left">15</td>
      <td style="text-align: right">10</td>
    </tr>
    <tr>
      <td style="text-align: left">153</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">18</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td style="text-align: right">63</td>
    </tr>
    <tr>
      <td style="text-align: left">20</td>
      <td style="text-align: right">14</td>
    </tr>
    <tr>
      <td style="text-align: left">200</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">24</td>
      <td style="text-align: right">8</td>
    </tr>
    <tr>
      <td style="text-align: left">25</td>
      <td style="text-align: right">5</td>
    </tr>
    <tr>
      <td style="text-align: left">28</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">3</td>
      <td style="text-align: right">42</td>
    </tr>
    <tr>
      <td style="text-align: left">30</td>
      <td style="text-align: right">11</td>
    </tr>
    <tr>
      <td style="text-align: left">35</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">4</td>
      <td style="text-align: right">25</td>
    </tr>
    <tr>
      <td style="text-align: left">40</td>
      <td style="text-align: right">9</td>
    </tr>
    <tr>
      <td style="text-align: left">48</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">5</td>
      <td style="text-align: right">38</td>
    </tr>
    <tr>
      <td style="text-align: left">50</td>
      <td style="text-align: right">6</td>
    </tr>
    <tr>
      <td style="text-align: left">6</td>
      <td style="text-align: right">15</td>
    </tr>
    <tr>
      <td style="text-align: left">7</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">70</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">8</td>
      <td style="text-align: right">7</td>
    </tr>
    <tr>
      <td style="text-align: left">80</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">9</td>
      <td style="text-align: right">2</td>
    </tr>
    <tr>
      <td style="text-align: left">98</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">ca. 18-23</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: left">Keinen</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<p>OK, let’s parse the numbers only; a typical problem in surveys is that respondent do not give numbers where you would like them to give numbers (some survey tools allow you to control what the respondent may put in the field).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">n_hangover</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">n_hangover</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning: 2 parsing failures.
## row col expected actual
## 132  -- a number       
## 425  -- a number      .
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">time_conversation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">time_conversation</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning: 1 parsing failure.
## row col expected actual
## 153  -- a number
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">n_party</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">n_party</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning: 1 parsing failure.
## row col expected actual
## 270  -- a number
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="o">$</span><span class="n">n_clients</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">clients</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning: 234 parsing failures.
## row col expected actual
##  34  -- a number       
##  37  -- a number       
##  38  -- a number       
##  39  -- a number       
##  42  -- a number       
## ... ... ........ ......
## See problems(...) for more details.
</code></pre>
</div>

<h2 id="checking-nas-for-items">Checking NA’s for items</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">gather</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">value</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">count</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 1 × 1
##       n
##   &lt;int&gt;
## 1    24
</code></pre>
</div>

<p>Hm, let’s see in more detail.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##   i01 i02 i03 i04r i05 i06 i07 i08r i09 i10
## 1   4   1   3   NA   4   2   3    2   3   2
## 2   4   2   3    2   2   1  NA    1   4   3
## 3   3   2   1    3   3   2   2    4   3  NA
## 4   3   2   1   NA   3   3   3    3   3   1
## 5   4   4   1    1  NA   4   4    2   3   2
## 6   3  NA   2    2   2   1   2    3   4   2
## 7  NA  NA  NA   NA  NA  NA  NA   NA  NA  NA
## 8  NA  NA   2    3  NA  NA  NA   NA  NA  NA
</code></pre>
</div>

<p>Hm, not so many cases have NAs. Let’s just exclude them, that’s the easiest, and we will not lose much (many cases, that is).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">complete.cases</span><span class="p">(</span><span class="n">.</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">nrow</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## [1] 493
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">i</span><span class="m">01</span><span class="o">:</span><span class="n">i</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">na.omit</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data_items</span><span class="w">
</span></code></pre>
</div>

<h1 id="plotting-item-distribution">Plotting item distribution</h1>

<h2 id="typical-stacked-bar-plot">Typical stacked bar plot</h2>
<p>The most obvious thing is to plot the distribution of the items (here: 10) of the survey. So let’s do that with <code class="highlighter-rouge">ggplot</code>.</p>

<p>On the x-axis we would like to have each item (i1, i2, …), and on the y-axis the frequency of each answer, in some stapled bar fashion. That means, on the x-axis is <em>one</em> variable only. That’s why we need to “melt” the items to one “long” variable.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">  
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">answer</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">1</span><span class="w">
</span><span class="n">p</span><span class="m">1</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /></p>

<p>Maybe nicer to turn it 90 degrees:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-11-1.png" alt="plot of chunk unnamed-chunk-11" /></p>

<p>And reverse the order of the items, so that <code class="highlighter-rouge">i01</code> is at the top.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_items</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">gather</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">answer</span><span class="p">),</span><span class="w">
         </span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">items</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data2</span><span class="w">
  
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data2</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_discrete</span><span class="p">(</span><span class="n">limits</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rev</span><span class="p">(</span><span class="n">levels</span><span class="p">(</span><span class="n">data2</span><span class="o">$</span><span class="n">items</span><span class="p">)))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">2</span><span class="w">
</span><span class="n">p</span><span class="m">2</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /></p>

<h2 id="colors">Colors</h2>

<p>The beauty of the colors lie in the eye of the beholder… Let’s try a different palette.</p>

<p>Sequential color palettes.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"Blues"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"BuGn"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-13-2.png" alt="plot of chunk unnamed-chunk-13" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">12</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-13-3.png" alt="plot of chunk unnamed-chunk-13" /></p>

<p>Diverging palettes.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RdYlGn"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_brewer</span><span class="p">(</span><span class="n">palette</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"RdYlBu"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-14-2.png" alt="plot of chunk unnamed-chunk-14" /></p>

<p>The divering palettes are useful because we have two “poles” - “do not agree” on one side, and “do agree” on the other side.</p>

<p>See <a href="https://www.r-bloggers.com/choosing-colour-palettes-part-ii-educated-choices/">here</a> for an overview on Brewer palettes.</p>

<p>Or maybe just grey tones.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_grey</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-15-1.png" alt="plot of chunk unnamed-chunk-15" /></p>

<p>My own favorite-cherished color.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">colours</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"#2121D9"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#9999FF"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#D92121"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#21D921"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#FFFF4D"</span><span class="p">,</span><span class="w"> </span><span class="s2">"#FF9326"</span><span class="p">)</span><span class="w">
</span><span class="n">p</span><span class="m">2</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="o">=</span><span class="n">colours</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-16-1.png" alt="plot of chunk unnamed-chunk-16" /></p>

<h2 id="numbers-count-on-bars">Numbers (count) on bars</h2>

<p>It might be helpful to print the exact numbers on the bars.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data2</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">count</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">answer</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">y_pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_items</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="m">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">n</span><span class="o">/</span><span class="n">nrow</span><span class="p">(</span><span class="n">data_items</span><span class="p">)),</span><span class="w">
         </span><span class="n">y_cumsum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">cumsum</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">items</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data3</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_pos</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">3</span><span class="w">

</span><span class="n">p</span><span class="m">3</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-17-1.png" alt="plot of chunk unnamed-chunk-17" /></p>

<p>Flip coordinate system, and with “%” labels.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">3</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scales</span><span class="o">::</span><span class="n">percent</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"proportion of respondents"</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">4</span><span class="w">
</span><span class="n">p</span><span class="m">4</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-18-1.png" alt="plot of chunk unnamed-chunk-18" /></p>

<h2 id="highlight-main-category">Highlight main category</h2>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data3</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">answer</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">max_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">max_cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_n</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">fit_cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_cat</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data4</span><span class="w">


</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data4</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">answer</span><span class="p">),</span><span class="w">
               </span><span class="n">color</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fit_cat</span><span class="p">),</span><span class="w"> </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fill"</span><span class="p">,</span><span class="w"> </span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_pos</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w">  </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"NA"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w"> </span><span class="n">guide</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"none"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_grey</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-19-1.png" alt="plot of chunk unnamed-chunk-19" /></p>

<p>To be honest, does really look nice. Let’s try something different later.</p>

<h2 id="barplot-with-geomrect">Barplot with <code class="highlighter-rouge">geom_rect</code></h2>

<p>This section and code is inspired by <a href="http://rnotr.com/likert/ggplot/barometer/likert-plotly/">this post</a>.</p>

<p>The goal is to produce a more flexible bar plot, such as a “waterfall plot”, where y= 0 is centered at the middle bar height, we need to change the <code class="highlighter-rouge">geom</code>. No more <code class="highlighter-rouge">geom_bar</code> but the more versatile <code class="highlighter-rouge">geom_rect</code>. This geom plots, surprisingly, rectangles. Hence, we need to know the start and the end value (for the y-axis, the width of the bar is just 1).</p>

<p>First, we need to prepare the dataset for that task.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data4</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">answer</span><span class="p">,</span><span class="w"> </span><span class="n">y_cumsum</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">spread</span><span class="p">(</span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_cumsum</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">zero</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">data_items</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">zero</span><span class="p">,</span><span class="w"> </span><span class="n">`1`</span><span class="p">,</span><span class="w"> </span><span class="n">`2`</span><span class="p">,</span><span class="w"> </span><span class="n">`3`</span><span class="p">,</span><span class="w"> </span><span class="n">`4`</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data5</span><span class="w">



</span><span class="n">data5</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">rename</span><span class="p">(</span><span class="n">start_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">zero</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">end_1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`1`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">start_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`1`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">end_2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`2`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">start_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`2`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">end_3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`3`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">start_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">`3`</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">end_4</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">start_1</span><span class="p">,</span><span class="w"> </span><span class="n">end_1</span><span class="p">,</span><span class="w"> </span><span class="n">start_2</span><span class="p">,</span><span class="w"> </span><span class="n">end_2</span><span class="p">,</span><span class="w"> </span><span class="n">start_3</span><span class="p">,</span><span class="w"> </span><span class="n">end_3</span><span class="p">,</span><span class="w"> </span><span class="n">start_4</span><span class="p">,</span><span class="w"> </span><span class="n">end_4</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data6</span><span class="w">

</span><span class="n">head</span><span class="p">(</span><span class="n">data6</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: right">items_num</th>
      <th style="text-align: right">start_1</th>
      <th style="text-align: right">end_1</th>
      <th style="text-align: right">start_2</th>
      <th style="text-align: right">end_2</th>
      <th style="text-align: right">start_3</th>
      <th style="text-align: right">end_3</th>
      <th style="text-align: right">start_4</th>
      <th style="text-align: right">end_4</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">46</td>
      <td style="text-align: right">46</td>
      <td style="text-align: right">273</td>
      <td style="text-align: right">273</td>
      <td style="text-align: right">493</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">396</td>
      <td style="text-align: right">396</td>
      <td style="text-align: right">476</td>
      <td style="text-align: right">476</td>
      <td style="text-align: right">493</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">203</td>
      <td style="text-align: right">203</td>
      <td style="text-align: right">366</td>
      <td style="text-align: right">366</td>
      <td style="text-align: right">461</td>
      <td style="text-align: right">461</td>
      <td style="text-align: right">493</td>
    </tr>
    <tr>
      <td style="text-align: right">4</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">203</td>
      <td style="text-align: right">203</td>
      <td style="text-align: right">414</td>
      <td style="text-align: right">414</td>
      <td style="text-align: right">490</td>
      <td style="text-align: right">490</td>
      <td style="text-align: right">493</td>
    </tr>
    <tr>
      <td style="text-align: right">5</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">11</td>
      <td style="text-align: right">11</td>
      <td style="text-align: right">110</td>
      <td style="text-align: right">110</td>
      <td style="text-align: right">344</td>
      <td style="text-align: right">344</td>
      <td style="text-align: right">493</td>
    </tr>
    <tr>
      <td style="text-align: right">6</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">110</td>
      <td style="text-align: right">110</td>
      <td style="text-align: right">379</td>
      <td style="text-align: right">379</td>
      <td style="text-align: right">470</td>
      <td style="text-align: right">470</td>
      <td style="text-align: right">493</td>
    </tr>
  </tbody>
</table>

<p>OK, we have that, pooh, quite a mess.</p>

<p>So, now we need it in long form. Here come a not so elegant, but rather simple, solution for that.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data_cat1</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data6</span><span class="p">,</span><span class="w"> </span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">start_1</span><span class="p">,</span><span class="w"> </span><span class="n">end_1</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">setNames</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"items"</span><span class="p">,</span><span class="w"> </span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="s2">"end"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">data_cat2</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data6</span><span class="p">,</span><span class="w"> </span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">start_2</span><span class="p">,</span><span class="w"> </span><span class="n">end_2</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">setNames</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"items"</span><span class="p">,</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="s2">"end"</span><span class="p">))</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">data_cat3</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data6</span><span class="p">,</span><span class="w"> </span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">start_3</span><span class="p">,</span><span class="w"> </span><span class="n">end_3</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">setNames</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"items"</span><span class="p">,</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="s2">"end"</span><span class="p">))</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">)</span><span class="w">
</span><span class="n">data_cat4</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">data6</span><span class="p">,</span><span class="w"> </span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">start_4</span><span class="p">,</span><span class="w"> </span><span class="n">end_4</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">setNames</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s2">"items"</span><span class="p">,</span><span class="s2">"start"</span><span class="p">,</span><span class="w"> </span><span class="s2">"end"</span><span class="p">))</span><span class="w">  </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">4</span><span class="p">)</span><span class="w">

   
</span><span class="n">data7</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">bind_rows</span><span class="p">(</span><span class="n">data_cat1</span><span class="p">,</span><span class="w"> </span><span class="n">data_cat2</span><span class="p">,</span><span class="w"> </span><span class="n">data_cat3</span><span class="p">,</span><span class="w"> </span><span class="n">data_cat4</span><span class="p">)</span><span class="w"> 

</span><span class="n">data7</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">head</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">kable</span><span class="w">
</span></code></pre>
</div>

<table>
  <thead>
    <tr>
      <th style="text-align: right">items</th>
      <th style="text-align: right">start</th>
      <th style="text-align: right">end</th>
      <th style="text-align: right">answer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: right">1</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">7</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">2</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">175</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">3</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">203</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">4</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">203</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">5</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">11</td>
      <td style="text-align: right">1</td>
    </tr>
    <tr>
      <td style="text-align: right">6</td>
      <td style="text-align: right">0</td>
      <td style="text-align: right">110</td>
      <td style="text-align: right">1</td>
    </tr>
  </tbody>
</table>

<p>Now let’s plot the bar graph with the rectangle plot.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data7</span><span class="o">$</span><span class="n">answer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">data7</span><span class="o">$</span><span class="n">answer</span><span class="p">)</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data7</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w">
                </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"items"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"n"</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">5</span><span class="w">

</span><span class="n">p</span><span class="m">5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_pos</span><span class="o">*</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">6</span><span class="w">

</span><span class="n">p</span><span class="m">6</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-22-1.png" alt="plot of chunk unnamed-chunk-22" /></p>

<p>Compare that to the <code class="highlighter-rouge">geom_bar</code> solution.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">3</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-23-1.png" alt="plot of chunk unnamed-chunk-23" /></p>

<p>Basically identical (never mind the bar width).</p>

<p>Now flip the coordinates again (and compare to previous solution with <code class="highlighter-rouge">geom_bar</code>).</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">6</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-24-1.png" alt="plot of chunk unnamed-chunk-24" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">4</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-24-2.png" alt="plot of chunk unnamed-chunk-24" /></p>

<p>Let’s try to highlight the most frequent answer category for each item.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data7</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">max_n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">max</span><span class="p">(</span><span class="n">n</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">max_cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">which</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_n</span><span class="p">)))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">fit_cat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">answer</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">max_cat</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data8</span><span class="w">

</span><span class="n">data8</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">fit_cat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data8a</span><span class="w">


</span><span class="n">data7</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w">
                </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"items"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">scale_fill_grey</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.4</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">8</span><span class="w">

    
</span><span class="n">p</span><span class="m">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data8a</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w">  </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data3</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_num</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_pos</span><span class="o">*</span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">8</span><span class="w">

</span><span class="n">p</span><span class="m">8</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-25-1.png" alt="plot of chunk unnamed-chunk-25" /></p>

<p><a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf">Here’s</a> a cheat sheet on colors and palettes; and <a href="https://www.nceas.ucsb.edu/~frazier/RSpatialGuides/colorPaletteCheatsheet.pdf">here</a> you’ll find an overview on colors (with names and hex codes).</p>

<p>Mrs. Brewer <a href="http://colorbrewer2.org/#type=sequential&amp;scheme=BuGn&amp;n=3">site</a> is a great place to come up with your own palette and learn more about colors.</p>

<h1 id="rainbow-diagram">Rainbow diagram</h1>
<p>Let’s try to “move” the bars to our wishes. Precisely, it would be nice if the bars were aligned at the “Rubicon” between “do <em>not</em> agree” and “<em>do</em> agree”. Then we could see better how many persons agree and not.</p>

<p>More practically, if we knew that 104+212 = 316 persons basically disagree, then 316 could be our “zero line” (item 10). Repeat that for each item.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data8</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">n_disagree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">)]),</span><span class="w">
         </span><span class="n">n_agree</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="m">4</span><span class="p">)]),</span><span class="w">
         </span><span class="n">start_adj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n_disagree</span><span class="p">,</span><span class="w">
         </span><span class="n">end_adj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n_disagree</span><span class="w">
         </span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data9</span><span class="w">


</span><span class="n">data9</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_adj</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_adj</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w">
                </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"items"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"n"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">scale_fill_grey</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.4</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">9</span><span class="w">

</span><span class="n">p</span><span class="m">9</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-26-1.png" alt="plot of chunk unnamed-chunk-26" /></p>

<p>Looks quite cool.</p>

<p>Now let’s add the numbers to that plot.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data4</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">items_num</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">parse_number</span><span class="p">(</span><span class="n">items</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">dplyr</span><span class="o">::</span><span class="n">select</span><span class="p">(</span><span class="o">-</span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">rename</span><span class="p">(</span><span class="n">items</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items_num</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">select</span><span class="p">(</span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">everything</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">answer</span><span class="p">,</span><span class="w"> </span><span class="n">items</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ungroup</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data10</span><span class="w">


</span><span class="n">data9</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">mutate</span><span class="p">(</span><span class="n">y_pos_adj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data10</span><span class="o">$</span><span class="n">y_pos</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">nrow</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">n_disagree</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data11</span><span class="w">



</span><span class="n">p</span><span class="m">9</span><span class="w"> </span><span class="o">+</span><span class="w">  
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data11</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_pos_adj</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">11</span><span class="w">

</span><span class="n">p</span><span class="m">11</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-27-1.png" alt="plot of chunk unnamed-chunk-27" /></p>

<p>And now let’s highlight the most frequent answer category.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggrepel</span><span class="p">)</span><span class="w">

</span><span class="n">data11</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w">
                </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_adj</span><span class="p">,</span><span class="w">
                </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_adj</span><span class="p">,</span><span class="w">
                </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w">
                </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w">
                </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">answer</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_grey</span><span class="p">(</span><span class="n">start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.4</span><span class="p">,</span><span class="w"> </span><span class="n">end</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.8</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_rect</span><span class="p">(</span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">data11</span><span class="p">,</span><span class="w"> </span><span class="n">fit_cat</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> 
            </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">start_adj</span><span class="p">,</span><span class="w"> 
                </span><span class="n">ymax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">end_adj</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="m">0.4</span><span class="p">,</span><span class="w"> 
                </span><span class="n">xmax</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="m">0.4</span><span class="p">),</span><span class="w">
            </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"red"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_text</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">items</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">y_pos_adj</span><span class="p">,</span><span class="w"> </span><span class="n">label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">n</span><span class="p">),</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"n"</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">p</span><span class="m">12</span><span class="w">
</span><span class="n">p</span><span class="m">12</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-28-1.png" alt="plot of chunk unnamed-chunk-28" /></p>

<p>OK, that’s about it for today. May turn the waterfall by 90°.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-29-1.png" alt="plot of chunk unnamed-chunk-29" /></p>

<p>And change the direction of the now numeric items-axis.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">p</span><span class="m">12</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">scale_x_reverse</span><span class="p">(</span><span class="n">breaks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Scale for 'x' is already present. Adding another scale for 'x', which
## will replace the existing scale.
</code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-12/unnamed-chunk-30-1.png" alt="plot of chunk unnamed-chunk-30" /></p>

<p>Happy plotting!</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2016-11-09T00:00:00-05:00"><a href="https://sebastiansauer.github.io/Horoskop-Studie/">November 09, 2016</a></time></span><span class="author vcard"><span class="fn"><a href="https://sebastiansauer.github.io/about/" title="About Sebastian Sauer">Sebastian Sauer</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
Reading time ~12 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="https://sebastiansauer.github.io/Horoskop-Studie/" rel="bookmark" title="Horoskopstudie zum Barnumeffekt" itemprop="url">Horoskopstudie zum Barnumeffekt</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Viele Menschen glauben an Horoskope. Doch warum? Ein Grund könnte sein, dass Horoskope einfach gut sind. Was heißt gut: Sie passen auf mich aber nicht auf andere Leute (mit anderen Strernzeichen) und sie sagen Dinge, die nützlich sind.</p>

<p>Ein anderer Grund könnte sein, dass sie uns schmeicheln und Gemeinplätze sind, denen jeder zustimmt: “Sie sind an sich ein Super-Typ, aber manchmal etwas ungeduldig” (oh ja, absolut, passt genau!). “Heute treffen Sie jemanden, der eine große Liebe werden könnte” (Hört sich gut an!). “Wenn Sie nicht aufpassen, könnte Ihnen heute ein Patzer unterlaufen” (Gut, dass ich gewarnt bin, ist nichts passiert heute, was beweisst, dass es richtig war, aufzupassen, Danke, Horoskop!).</p>

<p>Mit anderen Worten: Diese “Null-Hypothese” sagt, dass Horoskop ist so formuliert, dass man gerne zustimmt - unabhängig von den Inhalten. Die Studierenden in meinem Kurs wollten das überprüfen (das ist ein typischer Dozentensatz). Dafür haben wir uns folgende Studie überlegt: Wir legen unbedarften Versuchspersonen entweder ein <em>echtes</em> (vom Urheber des Horoskops als “wahr” erachtet) oder ein von uns <em>gefälschtes</em> Horoskop vor. Dann fragen wir, kurz gesagt: “Wie gut passt das Horoskop auf Dich?”.</p>

<p><em>Wenn</em> das Horoskop nur Blabla ist, sollte das “Passungsgefühl” (wie gut das Horoskop auf die befragte Person passt) bei echten und gefälschten Horoskopen ungefähr gleich sein. <em>Wenn</em> die Horoskope die Menschen aber gut beschreiben sollten, dann sollten <em>nur</em> die Leute mit echten Horoskopen eine gute Passung berichten, nicht aber die Leute mit den gefälschten Horoskopen. Damit liegt die Hypothesen klar auf den Tisch – für uns, nicht für die Versuchspersonen, denen wir erstmal einen Bären aufbinden (müssen). Das nennt man dann “Coverstory” (klingt freundlicher und cooler).</p>

<p>In der Psychologie ist dieser Effekt als <a href="https://de.wikipedia.org/wiki/Barnum-Effekt">Barnumeffekt</a> bekannt.</p>

<p>Schauen wir uns mal die Daten an.</p>

<h1 id="daten-einlesen">Daten einlesen</h1>

<p>Excel-Datei einlesen.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w">
</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="s2">"~/Downloads/horo.xlsx"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Oder online die CSV-Datei einlesen.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="s2">"https://sebastiansauer.github.io/data/horo.csv"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="erster-blick">Erster Blick</h1>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span><span class="w">
</span><span class="n">glimpse</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Observations: 54
## Variables: 6
## $ Sternzeichen   &lt;fctr&gt; Zwilling, Skorpion, Skorpion, Steinbock, Waage...
## $ Wahnehmung     &lt;dbl&gt; 0.00, 0.33, 0.33, 0.67, 0.67, 0.00, 0.33, 0.67,...
## $ Geschlecht     &lt;fctr&gt; weiblich, männlich, männlich, weiblich, männli...
## $ Alter          &lt;int&gt; 21, 27, 27, 26, 25, 26, 29, 26, 29, 30, 26, 33,...
## $ Gruppe         &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ Richtig_Falsch &lt;fctr&gt; F, F, F, F, F, F, F, F, F, R, R, R, R, R, R, R...
</code></pre>
</div>

<h1 id="nas-loswerden">NAs loswerden</h1>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="n">row_number</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">44</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="w">  </span><span class="c1"># ab Zeile 45 kommen nur noch Leerzeilen
# oder in der Excel-Datei die Zeilen (ab Z. 45) löschen
</span></code></pre>
</div>

<h1 id="check">Check</h1>

<p>Rechtschreibfehler bei “Wahnehmung”, das korrigieren wir.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">rename</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">Wahrnehmung</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wahnehmung</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">data</span><span class="w">
</span></code></pre>
</div>

<p>Die Anzahl der “richtigen” und “falschen” Profilen sollte (etwa) gleich sein.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">count</span><span class="p">(</span><span class="n">Richtig_Falsch</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 2 × 2
##   Richtig_Falsch     n
##           &lt;fctr&gt; &lt;int&gt;
## 1              F    20
## 2              R    24
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Richtig_Falsch</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-6-1.png" alt="plot of chunk unnamed-chunk-6" />
Ok, passt in etwa.</p>

<p>Schauen wir uns mal die Verteilung der Horoskope an.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sternzeichen</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-7-1.png" alt="plot of chunk unnamed-chunk-7" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Sternzeichen</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Richtig_Falsch</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">coord_flip</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-7-2.png" alt="plot of chunk unnamed-chunk-7" /></p>

<p>Spaßeshalber: Die Altersverteilung.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Geschlecht</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-8-1.png" alt="plot of chunk unnamed-chunk-8" /></p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">summary</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">Alter</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##   21.00   26.00   27.00   28.56   29.75   38.00      26
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">qplot</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Alter</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Geschlecht</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Geschlecht</span><span class="p">,</span><span class="w"> </span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"boxplot"</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">.3</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Warning: Removed 26 rows containing non-finite values (stat_boxplot).
</code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-10-1.png" alt="plot of chunk unnamed-chunk-10" /></p>

<h1 id="wahrnehmung">“Wahrnehmung”</h1>
<p>Ist die gefühlte Passgenauigkeit zwischen den beiden Gruppen gleich, so wie es der Barnum-Effekt vorhersagt?</p>

<p>Schauen wir mal…</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="nf">is.na</span><span class="p">(</span><span class="n">Wahrnehmung</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">group_by</span><span class="p">(</span><span class="n">Richtig_Falsch</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">wahr_group_mean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">Wahrnehmung</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w">
            </span><span class="n">wahr_group_md</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">Wahrnehmung</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">results1</span><span class="w">

</span><span class="n">results1</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 2 × 3
##   Richtig_Falsch wahr_group_mean wahr_group_md
##           &lt;fctr&gt;           &lt;dbl&gt;         &lt;dbl&gt;
## 1              F       0.5835000         0.670
## 2              R       0.4445833         0.415
</code></pre>
</div>

<p>Das plotten wir mal, ist ja so was wie ein zentrales Ergebnis.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">results1</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">aes</span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">wahr_group_mean</span><span class="p">,</span><span class="w"> 
      </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Richtig_Falsch</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">stat</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"identity"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">xlab</span><span class="p">(</span><span class="s2">"Horoskop-Typ (Richtig vs. Falsch)"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylab</span><span class="p">(</span><span class="s2">"Gefühlte Passung des Horoskops"</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-12-1.png" alt="plot of chunk unnamed-chunk-12" /></p>

<p>Eigentlich ist dieses Bild recht informationsarm. Schöner ist es (vielleicht) so:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Richtig_Falsch</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Wahrnehmung</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_boxplot</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_jitter</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-13-1.png" alt="plot of chunk unnamed-chunk-13" /></p>

<p>Hm, sieht etwas komisch aus. Vielleicht lieber ein Histogramm:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">Wahrnehmung</span><span class="p">),</span><span class="w"> </span><span class="n">fill</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Richtig_Falsch</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_bar</span><span class="p">(</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"dodge"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="https://sebastiansauer.github.io/images/2016-11-09/unnamed-chunk-14-1.png" alt="plot of chunk unnamed-chunk-14" /></p>

<p>Das ist ganz aufschlussreich. Die Balken sind überall in etwa gleich hoch. Nur bei “Null-Passung” finden sich hauptsächlich <em>echte</em> Horoskope. Das spricht nicht für die Glaubhaftigkeit der Horoskope - und damit indirekt Unterstützung für den Barnum-Effekt.</p>

<h1 id="inferenzstatistik">Inferenzstatistik</h1>
<p>Schauen wir mal ob sich die beiden Profilgruppen signifikant voneinander unterscheiden:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">t.test</span><span class="p">(</span><span class="n">Wahrnehmung</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="n">Richtig_Falsch</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## 
## 	Welch Two Sample t-test
## 
## data:  Wahrnehmung by Richtig_Falsch
## t = 1.2085, df = 41.436, p-value = 0.2337
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -0.09315257  0.37098591
## sample estimates:
## mean in group F mean in group R 
##       0.5835000       0.4445833
</code></pre>
</div>

<p>Der p-Wert ist größer als .05, also nicht signifikant.</p>

<h1 id="effektstrke-und-konfidenzintervall">Effektstärke und Konfidenzintervall</h1>
<p>Wie groß ist die Effektstärke des Unterschieds? Wie groß ist das Konfidenzintervall der Effektstärke?</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">data</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> 
  </span><span class="n">count</span><span class="p">(</span><span class="n">Richtig_Falsch</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## # A tibble: 2 × 2
##   Richtig_Falsch     n
##           &lt;fctr&gt; &lt;int&gt;
## 1              F    20
## 2              R    24
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">compute.es</span><span class="p">)</span><span class="w">
</span><span class="n">tes</span><span class="p">(</span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1.21</span><span class="p">,</span><span class="n">n</span><span class="m">.1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">20</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="m">.2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">24</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>## Mean Differences ES: 
##  
##  d [ 95 %CI] = 0.37 [ -0.25 , 0.98 ] 
##   var(d) = 0.09 
##   p-value(d) = 0.24 
##   U3(d) = 64.29 % 
##   CLES(d) = 60.22 % 
##   Cliff's Delta = 0.2 
##  
##  g [ 95 %CI] = 0.36 [ -0.25 , 0.96 ] 
##   var(g) = 0.09 
##   p-value(g) = 0.24 
##   U3(g) = 64.05 % 
##   CLES(g) = 60.04 % 
##  
##  Correlation ES: 
##  
##  r [ 95 %CI] = 0.18 [ -0.13 , 0.46 ] 
##   var(r) = 0.02 
##   p-value(r) = 0.24 
##  
##  z [ 95 %CI] = 0.19 [ -0.13 , 0.5 ] 
##   var(z) = 0.02 
##   p-value(z) = 0.24 
##  
##  Odds Ratio ES: 
##  
##  OR [ 95 %CI] = 1.94 [ 0.64 , 5.94 ] 
##   p-value(OR) = 0.24 
##  
##  Log OR [ 95 %CI] = 0.66 [ -0.45 , 1.78 ] 
##   var(lOR) = 0.31 
##   p-value(Log OR) = 0.24 
##  
##  Other: 
##  
##  NNT = 8.53 
##  Total N = 44
</code></pre>
</div>

<p>Wie im Output steht:
&gt; d [ 95 %CI] = 0.37 [ -0.25 , 0.98 ]</p>

<h1 id="fazit">Fazit</h1>
<p>Die Daten sprechen nicht für die Glaubwürdigkeit der Horoskope; in beiden Gruppen (echt vs. gefakt) war die gefühlte Passung ählich. Wir fanden wenig Unterstützung <em>für</em> die Glaubwürdigkeit der Horoskope (bzw. dass die Leute die echten Horoskope glaubhafter einschätzten).</p>

<p>Der Signifikanztest war nicht signifikant; der Unterschied der Mittelwerte reichte nicht aus, um die H0 der Gleichheit zu verwerfen. Dieses Ergebnis kann auf die geringe Stichprobengröße zurückgeführt werden; andererseits kann es auch als Beleg für die Nullhypothese verstanden werden. Natürlich lassen die vorliegenden Daten keine starken Schlüsse zu; aber hey - es war eine schöne Übung :)</p>

<p>Die großen  Effektstärkeintervalle sprechen dafür, dass der Effekt nur ungenau geschätzt wurde (aufgrund der geringen Stichprobengröße), was die Aussagekraft der Ergebnisse weiter abschwächt.</p>

<p>Witzigerweise war die mittlere subjektive Passung in der “gefälschten” Gruppe <em>höher</em> als in der “echten” Gruppe; dieser Effekt war von mittlerer Stärke (d = 0.37). Anschaulicher gesprochen: Zieht man eine Person aus jeder Gruppe, so ist die Wahrscheinlichkeit, dass die Person aus der “gefälschten” Gruppe ein größeres Passungsgefühlt hat, ca. 64% (bestenfalls).</p>

<h1 id="schluss-aus-feierabend">Schluss, aus, Feierabend</h1>
<p>Ok, für heute reichts :)</p>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->



<div class="pagination">
  <ul class="inline-list">
    
    

    
    
      <li><strong class="current-page">1</strong></li>
    

    
    

    
    
    

    
      
        
        
        
        <li><a href="https://sebastiansauer.github.io/page2/">2</a></li>
      
    
      
        
        
        
        <li><a href="https://sebastiansauer.github.io/page3/">3</a></li>
      
    

    
    
      <li>…</li>
    

    
      <li><a href="https://sebastiansauer.github.io/page9/">9</a></li>
    

    
    
      <li><a href="https://sebastiansauer.github.io/page2/" class="btn">Next</a></li>
    
  </ul>
</div>

</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2016 Sebastian Sauer. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="https://sebastiansauer.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="https://sebastiansauer.github.io/assets/js/scripts.min.js"></script>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



          

</body>
</html>